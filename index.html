<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ecossistema Docente ‚Äî V2 (Jogo Cr√≠tico)</title>
  <style>
    :root{
      /* Paleta clara (menos ‚Äúnoite‚Äù) */
      --bg0:#f6f7fb;
      --bg1:#eef2ff;
      --card:#ffffff;
      --stroke: rgba(17,24,39,.10);
      --txt:#0f172a;
      --muted: rgba(15,23,42,.70);

      --r:#2563eb; /* pesquisa */
      --e:#16a34a; /* extens√£o */
      --t:#f59e0b; /* ensino */
      --g:#7c3aed; /* gest√£o */
      --i:#ef4444; /* inova√ß√£o */
      --b:#475569; /* burocracia */

      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;

      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --radius: 16px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1000px 700px at 12% 10%, rgba(37,99,235,.10) 0%, transparent 55%),
        radial-gradient(900px 650px at 85% 20%, rgba(124,58,237,.10) 0%, transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--txt);
    }

    header{
      max-width:1200px; margin:0 auto;
      padding:18px 16px 10px;
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:46px; height:46px; border-radius:14px;
      background: conic-gradient(from 180deg, var(--r), var(--e), var(--t), var(--g), var(--i), var(--r));
      box-shadow: var(--shadow);
      border:1px solid rgba(15,23,42,.10);
    }
    h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    .subtitle{
      margin:4px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      max-width:760px;
    }

    .top-actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button{
      background: #fff;
      border: 1px solid rgba(15,23,42,.12);
      color: var(--txt);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: .15s transform, .15s box-shadow, .15s background;
      font-weight: 750;
      box-shadow: 0 6px 18px rgba(15,23,42,.06);
    }
    button:hover{ transform: translateY(-1px); box-shadow: 0 10px 24px rgba(15,23,42,.10); }
    button:active{ transform: translateY(0px); }
    .primary{
      background: linear-gradient(135deg, rgba(37,99,235,.14), rgba(124,58,237,.14));
      border-color: rgba(37,99,235,.18);
    }
    .danger{
      background: rgba(239,68,68,.10);
      border-color: rgba(239,68,68,.20);
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:0 16px 40px;
      display:grid; gap:14px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 980px){ main{ grid-template-columns:1fr; } }

    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-h{
      padding:14px 14px 10px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    .card-h h2{
      margin:0; font-size:14px; letter-spacing:.2px;
      display:flex; gap:10px; align-items:center;
    }
    .pill{
      font-size:12px; color: rgba(15,23,42,.72);
      padding:6px 10px; border-radius:999px;
      background: rgba(15,23,42,.04);
      border: 1px solid rgba(15,23,42,.08);
    }
    .card-b{ padding:14px; }

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:10px 14px 0;
    }
    .tab{
      padding:8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.03);
      cursor:pointer;
      font-weight:750;
      font-size:12px;
      user-select:none;
    }
    .tab.active{
      background: rgba(37,99,235,.10);
      border-color: rgba(37,99,235,.20);
    }

    .grid2{ display:grid; gap:10px; grid-template-columns: 1fr 1fr; }
    @media (max-width:700px){ .grid2{ grid-template-columns:1fr; } }

    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input, select, textarea{
      width:100%;
      background: #fff;
      border: 1px solid rgba(15,23,42,.14);
      color: var(--txt);
      padding:10px 12px;
      border-radius: 12px;
      outline:none;
    }
    textarea{ min-height:84px; resize:vertical; }

    .q{
      padding:12px;
      border-radius: 14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
      margin-bottom:10px;
    }
    .q-title{
      font-weight: 850;
      margin:0 0 8px;
      line-height:1.35;
      font-size:13px;
    }
    .q-sub{
      margin:0 0 10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .scale{
      display:flex; align-items:center; gap:10px;
    }
    .scale input[type="range"]{
      flex:1;
      accent-color: rgba(37,99,235,.9);
    }
    .scale .v{
      min-width:38px;
      text-align:center;
      font-weight:900;
      background: rgba(15,23,42,.05);
      border:1px solid rgba(15,23,42,.10);
      border-radius: 10px;
      padding:6px 8px;
    }
    .scaleHints{
      display:flex; justify-content:space-between;
      font-size:11px; color:var(--muted);
      margin-top:6px;
    }

    .bar{
      height:10px; border-radius:999px;
      background: rgba(15,23,42,.07);
      border: 1px solid rgba(15,23,42,.10);
      overflow:hidden;
    }
    .bar > i{
      display:block; height:100%; width:0%;
      background: linear-gradient(90deg, rgba(37,99,235,.85), rgba(124,58,237,.75));
    }

    .kpis{
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
    }
    .kpi{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
    }
    .kpi .v{ font-size:20px; font-weight:950; }
    .kpi .l{ font-size:12px; color:var(--muted); margin-top:2px; line-height:1.3; }

    .story{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
      line-height:1.6;
      font-size:13px;
      color: rgba(15,23,42,.92);
    }
    .story b{ color:var(--txt); }
    .quote{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      border:1px dashed rgba(15,23,42,.16);
      background: rgba(37,99,235,.05);
      font-size:13px;
      line-height:1.55;
    }

    .micro{ display:grid; gap:10px; margin-top:10px; }
    .move{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: #fff;
    }
    .move .ttl{ font-weight:950; margin:0 0 4px; }
    .move .txt{ margin:0; color:var(--muted); font-size:12px; line-height:1.45; }

    .checklist{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
    }
    .checklist h3{
      margin:0 0 8px;
      font-size:13px;
    }
    .ck{
      display:flex; gap:8px; align-items:flex-start;
      margin:8px 0;
      font-size:13px;
      color: rgba(15,23,42,.90);
    }
    .ck input{ margin-top:3px; }

    canvas{
      width:100%;
      height:320px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: #fff;
      display:block;
    }
    .small{
      font-size:12px; color:var(--muted);
      margin-top:8px;
      line-height:1.35;
    }

    .split{
      display:grid; gap:10px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width:980px){ .split{ grid-template-columns:1fr; } }

    .tagrow{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
      color:var(--muted); font-size:12px;
    }
    .tag{
      display:flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      background: rgba(15,23,42,.03);
      border:1px solid rgba(15,23,42,.08);
    }
    .dot{ width:10px; height:10px; border-radius:999px; background: #111; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Ecossistema Docente ‚Äî V2 (Diagn√≥stico Cr√≠tico + Plano de A√ß√£o)</h1>
        <p class="subtitle">
          Um jogo para professores refletirem: <b>o que eu fa√ßo</b>, <b>o que eu quero ser</b> e <b>o que o sistema me puxa para ser</b>.
          Aqui, burocracia √© atrito (n√£o voca√ß√£o). O resultado entrega <b>passo a passo</b> (7/30/90 dias).
        </p>
      </div>
    </div>

    <div class="top-actions">
      <button class="primary" id="btnRun">Gerar diagn√≥stico</button>
      <button id="btnSave">Salvar</button>
      <button id="btnLoad">Carregar</button>
      <button id="btnExport">Exportar imagem</button>
      <button class="danger" id="btnReset">Resetar</button>
    </div>
  </header>

  <main>
    <!-- ESQUERDA -->
    <section class="card">
      <div class="tabs">
        <div class="tab active" data-tab="responder">Responder</div>
        <div class="tab" data-tab="metas">Metas</div>
        <div class="tab" data-tab="perguntas">Perguntas</div>
      </div>

      <div id="tab-responder">
        <div class="card-h">
          <h2>üßæ Identidade & Contexto</h2>
          <span class="pill">V2 ‚Äî escalas (1‚Äì5) + pesos ocultos</span>
        </div>
        <div class="card-b">
          <div class="grid2">
            <div><label>Nome</label><input id="name" placeholder="Ex.: Ernandes"/></div>
            <div><label>Universidade</label><input id="uni" placeholder="Ex.: UNEMAT"/></div>
            <div><label>Departamento</label><input id="dept" placeholder="Ex.: Ci√™ncias Ambientais"/></div>
            <div><label>Programa(s)</label><input id="prog" placeholder="Ex.: PPGCA, PPGEO..."/></div>
            <div>
              <label>Fase da carreira</label>
              <select id="phase">
                <option value="early">In√≠cio (0‚Äì5 anos)</option>
                <option value="mid">Meio (6‚Äì15 anos)</option>
                <option value="senior">S√™nior (16+ anos)</option>
              </select>
            </div>
            <div><label>Horas ‚Äúreais‚Äù de trabalho por semana</label><input id="hours" type="number" min="1" max="120" value="45"/></div>
          </div>

          <div style="margin-top:12px;">
            <label>O que mais te puxa / te prende hoje? (opcional)</label>
            <textarea id="notes" placeholder="Ex.: reuni√µes, sistemas, falta de equipe, press√£o por papers, excesso de orienta√ß√µes, etc."></textarea>
          </div>

          <div style="margin-top:12px;">
            <div class="bar"><i id="pbar"></i></div>
            <div class="small">Progresso: <b><span id="answered">0</span>/<span id="totalQ">0</span></b> quest√µes respondidas.</div>
          </div>
        </div>
      </div>

      <div id="tab-metas" style="display:none;">
        <div class="card-h">
          <h2>üéØ Metas em 5 anos</h2>
          <span class="pill">defina seu ‚Äúnorte‚Äù (0‚Äì100)</span>
        </div>
        <div class="card-b">
          <div class="grid2">
            <div><label>Pesquisa üî¨</label><input id="goalR" type="number" min="0" max="100" value="70"></div>
            <div><label>Extens√£o üå±</label><input id="goalE" type="number" min="0" max="100" value="75"></div>
            <div><label>Ensino üéì</label><input id="goalT" type="number" min="0" max="100" value="70"></div>
            <div><label>Gest√£o üß≠</label><input id="goalG" type="number" min="0" max="100" value="40"></div>
            <div><label>Inova√ß√£o üöÄ</label><input id="goalI" type="number" min="0" max="100" value="60"></div>
            <div><label>Limite de burocracia aceit√°vel (0‚Äì100)</label><input id="tolB" type="number" min="0" max="100" value="35"></div>
          </div>
          <div class="small">
            ‚ÄúLimite de burocracia aceit√°vel‚Äù = quanto atrito voc√™ tolera <b>sem perder foco e sa√∫de</b>.
            Quanto menor, mais voc√™ precisa blindar agenda, automatizar e dizer ‚Äún√£o‚Äù com eleg√¢ncia.
          </div>
        </div>

        <div class="card-h">
          <h2>üï∞Ô∏è Seu ‚Äúideal de semana‚Äù</h2>
          <span class="pill">distribui√ß√£o percentual</span>
        </div>
        <div class="card-b">
          <div class="grid2">
            <div><label>% Pesquisa</label><input id="idealR" type="number" min="0" max="100" value="25"></div>
            <div><label>% Extens√£o</label><input id="idealE" type="number" min="0" max="100" value="25"></div>
            <div><label>% Ensino</label><input id="idealT" type="number" min="0" max="100" value="25"></div>
            <div><label>% Gest√£o</label><input id="idealG" type="number" min="0" max="100" value="15"></div>
            <div><label>% Inova√ß√£o</label><input id="idealI" type="number" min="0" max="100" value="10"></div>
            <div><label>% Burocracia (m√°x.)</label><input id="idealB" type="number" min="0" max="100" value="15"></div>
          </div>
          <div class="small">
            A soma n√£o precisa dar 100 agora ‚Äî o sistema normaliza. Mas se voc√™ exagera em Burocracia, o app vai te chamar aten√ß√£o.
          </div>
        </div>
      </div>

      <div id="tab-perguntas" style="display:none;">
        <div class="card-h">
          <h2>üß† Perguntas em r√©gua (1‚Äì5)</h2>
          <span class="pill">mais reflex√£o, menos ‚Äúacerto‚Äù</span>
        </div>
        <div class="card-b" id="quiz"></div>
        <div class="card-b">
          <button class="primary" id="btnRun2">Gerar diagn√≥stico</button>
          <div class="small">
            Regra do jogo: responda como voc√™ age <b>quando est√° sob press√£o</b>.
            Se responder como ‚Äúdeveria ser‚Äù, voc√™ n√£o v√™ o sistema te puxando.
          </div>
        </div>
      </div>
    </section>

    <!-- DIREITA -->
    <aside class="card">
      <div class="tabs">
        <div class="tab active" data-rtab="resultados">Resultados</div>
        <div class="tab" data-rtab="planos">Plano</div>
      </div>

      <div id="rtab-resultados">
        <div class="card-h">
          <h2>üìç Gr√°ficos (claro + robusto)</h2>
          <span class="pill" id="statusPill">aguardando‚Ä¶</span>
        </div>
        <div class="card-b">
          <div class="split">
            <div>
              <canvas id="radar" width="900" height="420"></canvas>
              <div class="tagrow">
                <span class="tag"><i class="dot" style="background:rgba(15,23,42,.85)"></i> Atual</span>
                <span class="tag"><i class="dot" style="background:rgba(15,23,42,.25)"></i> Desejado</span>
              </div>
              <div class="small">Radar mostra perfil (vetores) ‚Äî n√£o mede ‚Äúqualidade‚Äù, mede <b>distribui√ß√£o de energia</b>.</div>
            </div>

            <div>
              <canvas id="timeBars" width="900" height="420"></canvas>
              <div class="small">
                ‚ÄúBalan√ßo de Semana‚Äù: onde voc√™ est√° gastando energia hoje vs. onde voc√™ quer estar.
                Isso resolve sua cr√≠tica da Figura 2: aqui fica √≥bvio onde est√° o desvio.
              </div>
            </div>
          </div>

          <div style="height:10px"></div>
          <canvas id="bureau" width="900" height="360"></canvas>
          <div class="small">
            Burocracia aqui vira: <b>term√¥metro + drenos principais + a√ß√µes imediatas</b>.
          </div>
        </div>

        <div class="card-h">
          <h2>üìä Diagn√≥stico narrativo + criticidade</h2>
          <span class="pill">com filosofia do of√≠cio</span>
        </div>
        <div class="card-b">
          <div class="kpis">
            <div class="kpi">
              <div class="v" id="kpiCore">‚Äî</div>
              <div class="l">Seu eixo dominante hoje</div>
            </div>
            <div class="kpi">
              <div class="v" id="kpiRisk">‚Äî</div>
              <div class="l">Risco de captura burocr√°tica</div>
            </div>
          </div>

          <div style="height:10px"></div>
          <div class="story" id="story">
            Responda as perguntas e clique em <b>Gerar diagn√≥stico</b>.
          </div>

          <div class="quote" id="quote"></div>
        </div>
      </div>

      <div id="rtab-planos" style="display:none;">
        <div class="card-h">
          <h2>üß≠ Passo a passo (7 / 30 / 90 dias)</h2>
          <span class="pill">plano execut√°vel</span>
        </div>
        <div class="card-b">
          <div class="micro" id="moves"></div>

          <div class="checklist">
            <h3>‚úÖ Checklist pr√°tico (marque e volte amanh√£)</h3>
            <label style="margin:0 0 8px;color:var(--muted);font-size:12px;">Esses itens n√£o s√£o ‚Äúmotivacionais‚Äù. S√£o engenharia de sobreviv√™ncia docente.</label>
            <div class="ck"><input type="checkbox"> <div>Eu protegi <b>2 blocos semanais</b> inegoci√°veis para meu eixo principal.</div></div>
            <div class="ck"><input type="checkbox"> <div>Eu escolhi <b>1 dreno burocr√°tico</b> e criei template/automa√ß√£o/checklist.</div></div>
            <div class="ck"><input type="checkbox"> <div>Eu disse <b>um ‚Äún√£o‚Äù elegante</b> para algo que s√≥ alimentava ru√≠do.</div></div>
            <div class="ck"><input type="checkbox"> <div>Eu transformei uma a√ß√£o (ensino/extens√£o/pesquisa) em <b>processo cont√≠nuo</b> (ritual).</div></div>
            <div class="ck"><input type="checkbox"> <div>Eu documentei meu projeto em 1 p√°gina: objetivo, p√∫blico, rotina, indicadores, entregas.</div></div>
            <div class="ck"><input type="checkbox"> <div>Eu fiz 1 conversa ‚Äúde verdade‚Äù sobre <b>sa√∫de mental e inclus√£o</b> com minha turma/equipe.</div></div>
          </div>

          <div class="checklist">
            <h3>üß© O que √© ser professor universit√°rio (frases para fechar)</h3>
            <div id="closing"></div>
          </div>
        </div>
      </div>
    </aside>
  </main>

<script>
/**
 * ECOSSISTEMA DOCENTE V2
 * - Perguntas em escala 1..5
 * - Pesos ocultos
 * - Gr√°ficos: Radar, Balan√ßo de Semana, Term√¥metro de Burocracia
 */

const EMOJI = {R:"üî¨",E:"üå±",T:"üéì",G:"üß≠",I:"üöÄ",B:"‚ö´"};
const LABEL = {R:"Pesquisa",E:"Extens√£o",T:"Ensino",G:"Gest√£o",I:"Inova√ß√£o",B:"Burocracia"};

const QUESTIONS = [
  // 1) Identidade acad√™mica e autoria
  { id:"q1",  t:"Eu uso meus pr√≥prios artigos e projetos como material vivo de aula (com transpar√™ncia, cr√≠tica e m√©todo).", a:"Nunca", b:"Sempre",
    w:{R:1.2,T:1.1} },
  { id:"q2",  t:"Eu consigo transformar extens√£o em processo cont√≠nuo (n√£o s√≥ evento) com indicadores simples e parceiros fixos.", a:"Nunca", b:"Sempre",
    w:{E:1.4,G:0.6} },
  { id:"q3",  t:"Eu tenho rotina de escrita/produ√ß√£o (mesmo pequena) e ela sobrevive √† semana real.", a:"Nunca", b:"Sempre",
    w:{R:1.5,G:0.2} },
  { id:"q4",  t:"Eu assumo gest√£o apenas quando ela libera o coletivo (e eu coloco limite claro de tempo).", a:"Nunca", b:"Sempre",
    w:{G:1.1,B:-0.4} },

  // 2) Burocracia (atrito real)
  { id:"q5",  t:"Minha semana √© engolida por sistemas, formul√°rios, relat√≥rios duplicados e reuni√µes sem decis√£o.", a:"Nada", b:"Totalmente",
    w:{B:1.6} },
  { id:"q6",  t:"Eu consigo dizer ‚Äún√£o‚Äù de modo institucionalmente inteligente quando uma demanda s√≥ gera ru√≠do.", a:"Nunca", b:"Sempre",
    w:{G:0.7,B:-0.9} },
  { id:"q7",  t:"Eu automatizo/templatizo rotinas (orienta√ß√µes, relat√≥rios, planilhas, e-mails, fluxos) para n√£o repetir dor.", a:"Nunca", b:"Sempre",
    w:{I:0.7,G:0.6,B:-0.7} },

  // 3) Ensino contempor√¢neo + inclus√£o + neurodiversidade
  { id:"q8",  t:"Eu preparo aulas considerando alunos neurodivergentes (TDAH/TEA) com estrutura, previsibilidade e m√∫ltiplas formas de participa√ß√£o.", a:"Nunca", b:"Sempre",
    w:{T:1.1,G:0.2} },
  { id:"q9",  t:"Eu sei adaptar materiais para acessibilidade (surdos, cegos, baixa vis√£o, dislexia) ou buscar apoio/recursos para isso.", a:"Nada", b:"Muito",
    w:{T:1.2,G:0.3,B:0.2} },
  { id:"q10", t:"Eu trato avalia√ß√£o como forma√ß√£o (feedback, rubricas, refa√ß√£o), n√£o como puni√ß√£o ou burocracia.", a:"Nunca", b:"Sempre",
    w:{T:1.3,B:-0.2} },

  // 4) IA e √©tica
  { id:"q11", t:"Eu uso IA de forma √©tica e pedag√≥gica (como ferramenta de rascunho/explica√ß√£o) e ensino os limites dela.", a:"Nunca", b:"Sempre",
    w:{I:1.0,T:0.6,G:0.2} },
  { id:"q12", t:"Eu tenho pol√≠tica clara para IA na disciplina (o que pode, o que n√£o pode, e como citar/relatar uso).", a:"Nunca", b:"Sempre",
    w:{G:0.6,T:0.8} },

  // 5) Extens√£o cr√≠tica + sociologia da universidade
  { id:"q13", t:"Eu enxergo extens√£o como coprodu√ß√£o de conhecimento (n√£o assist√™ncia). O territ√≥rio muda a pergunta cient√≠fica.", a:"Nada", b:"Totalmente",
    w:{E:1.3,R:0.4} },
  { id:"q14", t:"Eu consigo trabalhar conflitos de interesse e poder na universidade (autoria, cr√©ditos, hierarquias) com firmeza e √©tica.", a:"Nunca", b:"Sempre",
    w:{G:0.9,B:0.2} },

  // 6) Gest√£o do tempo / sa√∫de / limites
  { id:"q15", t:"Eu protejo blocos de foco profundo (90‚Äì120 min) pelo menos 2x por semana.", a:"Nunca", b:"Sempre",
    w:{R:0.7,T:0.5,I:0.5,B:-0.4} },
  { id:"q16", t:"Eu sei reconhecer sinais de exaust√£o e ajustar o sistema (n√£o s√≥ ‚Äòaguentar‚Äô).", a:"Nunca", b:"Sempre",
    w:{G:0.6,B:-0.6} },

  // 7) Inova√ß√£o (sem virar ‚Äúhobby‚Äù)
  { id:"q17", t:"Eu transformo ideias em prot√≥tipos e valido com usu√°rios (alunos, territ√≥rio, gestores) antes de ‚Äúfechar‚Äù solu√ß√£o.", a:"Nunca", b:"Sempre",
    w:{I:1.4,E:0.2} },
  { id:"q18", t:"Eu consigo institucionalizar o que crio (documento, treino pessoas, deixo replic√°vel).", a:"Nunca", b:"Sempre",
    w:{G:0.8,I:0.8} },

  // 8) Pesquisa com sentido
  { id:"q19", t:"Minha pesquisa tem uma pergunta-m√£e que d√° coer√™ncia a projetos e evita dispers√£o por edital.", a:"Nada", b:"Totalmente",
    w:{R:1.4,G:0.2} },
  { id:"q20", t:"Eu consigo transformar dados e rotina de laborat√≥rio/campo em oportunidades formativas (ensino-pesquisa integrado).", a:"Nunca", b:"Sempre",
    w:{R:0.8,T:0.9} },

  // 9) Ensino como autoria intelectual (n√£o repeti√ß√£o)
  { id:"q21", t:"Eu evito virar repetidor de slides: eu construo autoria did√°tica (casos, atividades, projetos, perguntas).", a:"Nunca", b:"Sempre",
    w:{T:1.3,I:0.2} },

  // 10) Universidade como espa√ßo pol√≠tico (reflex√£o)
  { id:"q22", t:"Eu entendo que a universidade √© um campo de disputa (recursos, prest√≠gio, tempo) e ajo com estrat√©gia sem perder valores.", a:"Nada", b:"Totalmente",
    w:{G:1.0,B:0.2} },

  // 11) Burocracia fina (o que mata a ci√™ncia)
  { id:"q23", t:"Eu fa√ßo tarefas administrativas repetitivas que poderiam ser simplificadas/automatizadas, mas sigo fazendo do mesmo jeito.", a:"Nunca", b:"Sempre",
    w:{B:1.2} },
  { id:"q24", t:"Reuni√µes ocupam meu melhor hor√°rio cognitivo.", a:"Nunca", b:"Sempre",
    w:{B:1.1} },

  // 12) Lideran√ßa
  { id:"q25", t:"Eu formo pessoas para serem melhores que eu (delega√ß√£o com confian√ßa + crit√©rio), n√£o ‚Äòdependentes‚Äô de mim.", a:"Nunca", b:"Sempre",
    w:{G:0.8,T:0.6,E:0.3} }
];

const quizEl = document.getElementById("quiz");
document.getElementById("totalQ").textContent = QUESTIONS.length;

function buildQuiz(){
  quizEl.innerHTML = "";
  QUESTIONS.forEach((q, idx)=>{
    const wrap = document.createElement("div");
    wrap.className = "q";
    wrap.dataset.q = idx;

    const title = document.createElement("p");
    title.className = "q-title";
    title.textContent = (idx+1) + ") " + q.t;

    const sub = document.createElement("p");
    sub.className = "q-sub";
    sub.textContent = "Use a r√©gua: 1 (discordo/ausente) ‚Üí 5 (concordo/presente).";

    const scale = document.createElement("div");
    scale.className = "scale";

    const range = document.createElement("input");
    range.type = "range";
    range.min = "1"; range.max = "5"; range.step = "1";
    range.value = "";
    range.id = q.id;

    const v = document.createElement("div");
    v.className = "v";
    v.textContent = "‚Äî";

    range.addEventListener("input", ()=>{
      v.textContent = range.value;
      updateProgress();
    });

    scale.appendChild(range);
    scale.appendChild(v);

    const hints = document.createElement("div");
    hints.className = "scaleHints";
    hints.innerHTML = `<span>${q.a}</span><span>${q.b}</span>`;

    wrap.appendChild(title);
    wrap.appendChild(sub);
    wrap.appendChild(scale);
    wrap.appendChild(hints);
    quizEl.appendChild(wrap);
  });
}

function countAnswered(){
  let n=0;
  QUESTIONS.forEach(q=>{
    const v = document.getElementById(q.id).value;
    if(v && Number(v)>=1) n++;
  });
  return n;
}

function updateProgress(){
  const n = countAnswered();
  document.getElementById("answered").textContent = n;
  const pct = Math.round((n/QUESTIONS.length)*100);
  document.getElementById("pbar").style.width = pct + "%";
}

function clampNum(id){
  const el = document.getElementById(id);
  let v = Number(el.value);
  if(!Number.isFinite(v)) v = 0;
  v = Math.max(0, Math.min(100, Math.round(v)));
  el.value = v;
  return v;
}

function normalizeWeek(ideal){
  // normaliza distribui√ß√£o em 100
  const sum = Object.values(ideal).reduce((a,b)=>a+b,0);
  const base = Math.max(1, sum);
  const out = {};
  for(const k in ideal) out[k] = Math.round((ideal[k]/base)*100);
  return out;
}

function compute(){
  const missing = [];
  // score acumulado
  const raw = {R:0,E:0,T:0,G:0,I:0,B:0};

  QUESTIONS.forEach((q, i)=>{
    const v = Number(document.getElementById(q.id).value);
    if(!Number.isFinite(v) || v<1){
      missing.push(i+1);
      return;
    }
    // escala 1..5 -> centrada em 0..1 (0 a 1)
    // 1=>0, 5=>1
    const x = (v - 1) / 4;
    // aplica pesos (ocultos)
    for(const k in q.w){
      raw[k] += x * q.w[k];
    }
  });

  // converte em percentuais: pega apenas R,E,T,G,I para perfil e B separado
  const mainKeys = ["R","E","T","G","I"];
  const mainSum = mainKeys.reduce((a,k)=>a + Math.max(0, raw[k]), 0);
  const base = Math.max(0.0001, mainSum);

  const cur = {
    R: Math.round((Math.max(0,raw.R)/base)*100),
    E: Math.round((Math.max(0,raw.E)/base)*100),
    T: Math.round((Math.max(0,raw.T)/base)*100),
    G: Math.round((Math.max(0,raw.G)/base)*100),
    I: Math.round((Math.max(0,raw.I)/base)*100),
    B: Math.max(0, Math.min(100, Math.round( (raw.B + 1.8) * 28 ))) // escala heur√≠stica
  };

  const goal = {
    R: clampNum("goalR"),
    E: clampNum("goalE"),
    T: clampNum("goalT"),
    G: clampNum("goalG"),
    I: clampNum("goalI"),
    tolB: clampNum("tolB")
  };

  // ideal de semana
  const ideal = normalizeWeek({
    R: clampNum("idealR"),
    E: clampNum("idealE"),
    T: clampNum("idealT"),
    G: clampNum("idealG"),
    I: clampNum("idealI"),
    B: clampNum("idealB")
  });

  // atrito percebido (burocracia x limite toler√°vel)
  const friction = Math.round((cur.B * (100 - goal.tolB))/100);

  // estimativa de ‚Äúsemana atual‚Äù (heur√≠stica):
  // usa o perfil para estimar distribui√ß√£o + burocracia drena um bloco extra
  let currentWeek = {
    R: cur.R,
    E: cur.E,
    T: cur.T,
    G: cur.G,
    I: cur.I,
    B: Math.min(45, Math.max(10, Math.round(cur.B*0.40))) // B em % da semana (heur√≠stico)
  };
  currentWeek = normalizeWeek(currentWeek);

  // gaps
  const gap = {
    R: goal.R - cur.R,
    E: goal.E - cur.E,
    T: goal.T - cur.T,
    G: goal.G - cur.G,
    I: goal.I - cur.I
  };

  return {raw, cur, goal, ideal, currentWeek, friction, missing, gap};
}

function topRole(vec){
  const keys = ["R","E","T","G","I"];
  let best = keys[0];
  keys.forEach(k=>{ if(vec[k] > vec[best]) best = k; });
  return best;
}

function riskLabel(friction, B){
  const score = Math.round((B*0.55) + (friction*0.45));
  if(score >= 70) return {txt:"ALTO üî•", cls:"bad"};
  if(score >= 40) return {txt:"M√âDIO ‚ö†Ô∏è", cls:"warn"};
  return {txt:"BAIXO ‚úÖ", cls:"ok"};
}
function clsColor(cls){
  return cls==="bad" ? "var(--bad)" : (cls==="warn" ? "var(--warn)" : "var(--ok)");
}

// ---------- Diagn√≥stico narrativo (mais ‚Äúfilosofia‚Äù + criticidade) ----------
function phaseTxt(){
  const p = document.getElementById("phase").value;
  return p==="early" ? "in√≠cio de carreira" : (p==="mid" ? "meio de carreira" : "fase s√™nior");
}

function buildNarrative(data){
  const name = (document.getElementById("name").value || "Visitante").trim();
  const uni  = (document.getElementById("uni").value  || "sua universidade").trim();
  const dept = (document.getElementById("dept").value || "seu departamento").trim();
  const prog = (document.getElementById("prog").value || "seu programa").trim();
  const hours = clampNum("hours");

  const core = topRole(data.cur);
  const desired = topRole({
    R:data.goal.R, E:data.goal.E, T:data.goal.T, G:data.goal.G, I:data.goal.I
  });

  const rk = riskLabel(data.friction, data.cur.B);

  // maior gap
  const biggestGap = Object.keys(data.gap).reduce((a,k)=> Math.abs(data.gap[k]) > Math.abs(data.gap[a]) ? k : a, "R");
  const gapAbs = Math.abs(data.gap[biggestGap]);
  const gapDir = data.gap[biggestGap] >= 0 ? "crescer" : "reduzir";

  const bureaucracyTone =
    data.cur.B >= 65 ? "O sistema est√° tentando te transformar em operador de processos. Se voc√™ n√£o reagir, sua identidade acad√™mica vira fun√ß√£o administrativa." :
    data.cur.B >= 35 ? "A burocracia j√° √© um atrito relevante. O perigo n√£o √© ela existir ‚Äî √© ela ocupar seu melhor hor√°rio cognitivo." :
    "A burocracia parece controlada, mas cuidado: quando projetos escalam, o atrito cresce. Proteja processos antes do caos.";

  const alignment =
    core === desired
      ? "Seu eixo atual conversa com seu desejo. Agora √© menos sobre ‚Äòmudar de identidade‚Äô e mais sobre blindar foco e criar continuidade."
      : "Seu eixo atual n√£o conversa com seu desejo. Isso n√£o √© defeito ‚Äî √© diagn√≥stico: voc√™ est√° pagando custo invis√≠vel. A pergunta √©: o que voc√™ est√° sacrificando para sustentar o que faz hoje?";

  // pergunta filos√≥fica final (curta, mas forte)
  const phi = [
    "A universidade n√£o te mede pelo que voc√™ √© ‚Äî te mede pelo que consegue registrar. Seu trabalho √© n√£o virar ref√©m do registro.",
    "Ser professor √© sustentar um espa√ßo de pensamento quando o mundo s√≥ quer entrega.",
    "Quando a burocracia vira identidade, a universidade perde o sentido e ganha apenas funcionamento."
  ];
  const phiPick = phi[(data.cur.B + data.friction + data.cur.R) % phi.length | 0];

  const txt = `
    <b>${name}</b> ‚Äî <b>${uni}</b> (${dept}; ${prog}) ¬∑ <b>${phaseTxt()}</b> ¬∑ <b>${hours}h/semana reais</b><br><br>
    Seu eixo hoje: <b>${EMOJI[core]} ${LABEL[core]}</b>. Seu desejo (meta dominante): <b>${EMOJI[desired]} ${LABEL[desired]}</b>.<br>
    <b>${alignment}</b><br><br>
    <b>Burocracia:</b> ${data.cur.B}/100 ¬∑ <b>Fric√ß√£o percebida:</b> ${data.friction}/100 ¬∑ <b>Risco:</b> <span style="color:${clsColor(rk.cls)}"><b>${rk.txt}</b></span><br>
    ${bureaucracyTone}<br><br>
    Maior ajuste necess√°rio: <b>${gapDir}</b> em <b>${EMOJI[biggestGap]} ${LABEL[biggestGap]}</b> (~<b>${gapAbs}</b> pontos).<br>
    Pr√≥ximo passo: parar de tentar ‚Äúfazer tudo‚Äù e redesenhar <b>agenda, processos e compromissos</b> para o seu objetivo caber na semana real.
  `;

  return {txt, core, desired, rk, biggestGap};
}

function buildQuotes(data){
  // frases finais: o que √© ser professor universit√°rio (bem ‚Äúmanifesto‚Äù)
  const list = [
    "Professor universit√°rio n√£o √© um cargo: √© um sistema de escolhas sobre tempo, sentido e compromisso p√∫blico.",
    "Pesquisa sem ensino vira especializa√ß√£o muda. Ensino sem pesquisa vira repeti√ß√£o. Extens√£o sem criticidade vira evento. Gest√£o sem limite vira captura. Inova√ß√£o sem institui√ß√£o vira hobby.",
    "O trabalho invis√≠vel do docente n√£o √© fracasso ‚Äî √© terreno pol√≠tico. O problema √© quando o invis√≠vel ocupa o lugar do essencial.",
    "Voc√™ n√£o precisa ser tudo. Precisa ser coerente, cont√≠nuo e justo consigo e com os outros.",
    "A pergunta mais s√©ria n√£o √© ‚Äòo que eu produzi?‚Äô, √© ‚Äòo que eu sustentei de humano e de conhecimento apesar do sistema?‚Äô"
  ];

  // escolhe 3 com base no perfil
  const idx1 = (data.cur.R + data.cur.E + data.cur.T) % list.length;
  const idx2 = (data.cur.G + data.cur.I + data.cur.B) % list.length;
  const idx3 = (data.friction + data.cur.B) % list.length;

  return [list[idx1], list[idx2], list[idx3]];
}

// ---------- Plano 7/30/90 dias (passo a passo) ----------
function buildMoves(data, meta){
  const moves = [];
  const core = meta.core;
  const desired = meta.desired;
  const B = data.cur.B;
  const friction = data.friction;
  const gapKey = meta.biggestGap;

  // 7 dias: arrumar agenda + dreno
  moves.push({
    ttl:"7 dias ‚Äî Organizar o ch√£o (sem isso, nada escala)",
    txt:"(1) Bloqueie 2 sess√µes de foco (90‚Äì120 min) no seu melhor hor√°rio. (2) Liste 5 drenos burocr√°ticos da semana e ataque 1 com template/automa√ß√£o. (3) Marque uma reuni√£o ‚Äòcom decis√£o‚Äô (pauta + sa√≠da) e recuse reuni√£o sem pauta."
  });

  // 30 dias: transformar eixo em processo (ritual)
  const ritual = {
    R:"Defina pipeline: pergunta‚Üídados‚Üírascunho‚Üísubmiss√£o. Uma entrega por semana (mesmo pequena).",
    E:"Defina ritual mensal com parceiros fixos + 3 indicadores simples de impacto (n√£o s√≥ fotos).",
    T:"Defina 1 disciplina como ‚Äòlaborat√≥rio autoral‚Äô: casos, projetos, rubricas e feedback.",
    G:"Defina limites formais: agenda de gest√£o e o que voc√™ n√£o faz. Publique seu ‚Äòmanual de funcionamento‚Äô.",
    I:"Defina usu√°rio + problema + prot√≥tipo. Fa√ßa 2 testes com gente real antes de ‚Äòfinalizar‚Äô."
  };

  moves.push({
    ttl:"30 dias ‚Äî Transformar seu eixo em ritual (continuidade √© poder)",
    txt: ritual[desired] || "Escolha 1 processo que voc√™ repete e torne replic√°vel (manual + checklist + template)."
  });

  // 90 dias: alinhar a semana real com a semana desejada
  moves.push({
    ttl:"90 dias ‚Äî Reequilibrar a semana (e n√£o viver apagando inc√™ndio)",
    txt:"Compare seu ‚ÄòBalan√ßo de Semana‚Äô (gr√°fico) com seu ideal. Escolha 2 mudan√ßas estruturais: (a) cortar/encurtar reuni√µes, (b) delegar uma rotina, (c) automatizar relat√≥rio, (d) reduzir n√∫mero de frentes abertas. Reavalie com este app no dia 90."
  });

  // Antiburocracia espec√≠fica
  if(B >= 50 || friction >= 50){
    moves.push({
      ttl:"Plano antiburocracia ‚Äî 3 golpes objetivos",
      txt:"1) Template de respostas (orienta√ß√£o, e-mail, relat√≥rios). 2) ‚ÄòReuni√£o s√≥ com pauta + decis√£o‚Äô. 3) Uma lista p√∫blica do que voc√™ n√£o faz (limites). Burocracia n√£o pode virar identidade."
    });
  } else {
    moves.push({
      ttl:"Preven√ß√£o antiburocracia ‚Äî n√£o espere piorar",
      txt:"Antes de crescer projetos, documente: fluxos, arquivos, pap√©is, prazos, indicadores. A maioria dos docentes quebra por falta de processo, n√£o por falta de ideia."
    });
  }

  // Inclus√£o / IA ‚Äî sempre presente
  moves.push({
    ttl:"Doc√™ncia contempor√¢nea ‚Äî IA + inclus√£o sem romantizar",
    txt:"Defina uma pol√≠tica de IA (o que pode, como declarar). Adapte material para acessibilidade (texto alternativo, linguagem clara, m√∫ltiplas formas de participa√ß√£o). Isso n√£o √© ‚Äòextra‚Äô: √© qualidade do ensino."
  });

  // Ponte se core != desired
  if(core !== desired){
    moves.push({
      ttl:"Ponte identit√°ria ‚Äî do que voc√™ √© ao que quer ser",
      txt:"Crie 1 projeto-ponte: use seu eixo atual para alimentar o desejado. Ex.: pesquisa ‚Üí extens√£o (coprodu√ß√£o); extens√£o ‚Üí inova√ß√£o (ferramenta); ensino ‚Üí pesquisa (dados de aprendizagem)."
    });
  }

  // Mostrar ‚Äúonde mexer primeiro‚Äù pelo gap
  const gapAdvice = {
    R:"Para crescer pesquisa: proteja escrita e reduza frentes. Sem pipeline, tudo vira urg√™ncia.",
    E:"Para crescer extens√£o: menos eventos, mais continuidade (ritual + parceiros + indicadores).",
    T:"Para crescer ensino: transforme conte√∫do em experi√™ncia (casos, projetos, rubricas).",
    G:"Para crescer gest√£o: aceite que gest√£o √© engenharia social ‚Äî mas limite para n√£o virar operador.",
    I:"Para crescer inova√ß√£o: valide com usu√°rio e institucionalize para n√£o morrer em voc√™."
  };

  moves.push({
    ttl:`Onde mexer primeiro (ajuste principal: ${EMOJI[gapKey]} ${LABEL[gapKey]})`,
    txt: gapAdvice[gapKey] || "Ajuste seu eixo com uma mudan√ßa estrutural de agenda/processo, n√£o com for√ßa de vontade."
  });

  return moves;
}

// ---------- Gr√°ficos ----------
const radar = document.getElementById("radar");
const timeBars = document.getElementById("timeBars");
const bureau = document.getElementById("bureau");

const rctx = radar.getContext("2d");
const tctx = timeBars.getContext("2d");
const bctx = bureau.getContext("2d");

function clear(ctx, c){ ctx.clearRect(0,0,c.width,c.height); }

function drawRadar(cur, goal){
  clear(rctx, radar);
  const W = radar.width, H = radar.height;
  const cx = W*0.50, cy = H*0.55;
  const radius = Math.min(W*0.33, H*0.38);
  const axes = ["R","E","T","G","I"];
  const n = axes.length;

  // fundo
  rctx.fillStyle = "#fff";
  rctx.fillRect(0,0,W,H);

  // rings
  rctx.save();
  rctx.translate(cx, cy);
  rctx.strokeStyle = "rgba(15,23,42,.10)";
  rctx.lineWidth = 1;
  for(let r=1;r<=5;r++){
    const rr = radius*(r/5);
    rctx.beginPath();
    for(let i=0;i<n;i++){
      const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
      const x = Math.cos(ang)*rr, y = Math.sin(ang)*rr;
      if(i===0) rctx.moveTo(x,y); else rctx.lineTo(x,y);
    }
    rctx.closePath(); rctx.stroke();
  }

  // axes + labels
  axes.forEach((k,i)=>{
    const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
    const x = Math.cos(ang)*radius, y = Math.sin(ang)*radius;
    rctx.beginPath();
    rctx.moveTo(0,0); rctx.lineTo(x,y);
    rctx.strokeStyle = "rgba(15,23,42,.12)"; rctx.stroke();

    rctx.fillStyle = "rgba(15,23,42,.90)";
    rctx.font = "900 13px ui-sans-serif, system-ui";
    const lx = Math.cos(ang)*(radius+26);
    const ly = Math.sin(ang)*(radius+26);
    rctx.textAlign = "center";
    rctx.fillText(`${EMOJI[k]} ${LABEL[k]}`, lx, ly+4);
  });

  function poly(vec, stroke, fill, alpha){
    rctx.beginPath();
    axes.forEach((k,i)=>{
      const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
      const val = (vec[k]||0)/100;
      const x = Math.cos(ang)*radius*val;
      const y = Math.sin(ang)*radius*val;
      if(i===0) rctx.moveTo(x,y); else rctx.lineTo(x,y);
    });
    rctx.closePath();
    rctx.strokeStyle = stroke;
    rctx.lineWidth = 2;
    rctx.stroke();
    rctx.fillStyle = fill;
    rctx.globalAlpha = alpha;
    rctx.fill();
    rctx.globalAlpha = 1;
  }

  // desired (leve)
  poly(goal, "rgba(15,23,42,.25)", "rgba(15,23,42,.08)", 1);
  // current (forte)
  poly(cur, "rgba(15,23,42,.85)", "rgba(15,23,42,.14)", 1);

  rctx.restore();

  // titulo
  rctx.fillStyle = "rgba(15,23,42,.92)";
  rctx.font = "950 16px ui-sans-serif, system-ui";
  rctx.textAlign = "left";
  rctx.fillText("Perfil ‚Äî Atual vs. Desejado", 14, 22);

  rctx.fillStyle = "rgba(15,23,42,.65)";
  rctx.font = "700 12px ui-sans-serif, system-ui";
  rctx.fillText("Isso mede distribui√ß√£o de energia (n√£o ‚Äòqualidade‚Äô).", 14, 42);
}

function drawTimeBars(curWeek, idealWeek){
  clear(tctx, timeBars);
  const W = timeBars.width, H = timeBars.height;

  tctx.fillStyle="#fff";
  tctx.fillRect(0,0,W,H);

  tctx.fillStyle="rgba(15,23,42,.92)";
  tctx.font="950 16px ui-sans-serif, system-ui";
  tctx.fillText("Balan√ßo de Semana ‚Äî Hoje vs. Ideal", 14, 22);

  tctx.fillStyle="rgba(15,23,42,.65)";
  tctx.font="700 12px ui-sans-serif, system-ui";
  tctx.fillText("Barras mostram % estimado de energia/tempo por eixo.", 14, 42);

  const keys = ["R","E","T","G","I","B"];
  const colors = {
    R:"rgba(37,99,235,.80)",
    E:"rgba(22,163,74,.80)",
    T:"rgba(245,158,11,.85)",
    G:"rgba(124,58,237,.80)",
    I:"rgba(239,68,68,.78)",
    B:"rgba(71,85,105,.70)"
  };

  const leftX = 80;
  const barW = W - 120;
  const rowH = 48;
  const topY = 70;

  keys.forEach((k, idx)=>{
    const y = topY + idx*rowH;

    // label
    tctx.fillStyle="rgba(15,23,42,.90)";
    tctx.font="900 12px ui-sans-serif, system-ui";
    tctx.textAlign="left";
    tctx.fillText(`${EMOJI[k]} ${LABEL[k]}`, 14, y+18);

    // back
    tctx.fillStyle="rgba(15,23,42,.06)";
    roundRect(tctx, leftX, y, barW, 14, 8, true, false);

    // current
    const cw = Math.round((curWeek[k]/100)*barW);
    tctx.fillStyle=colors[k];
    roundRect(tctx, leftX, y, cw, 14, 8, true, false);

    // ideal marker line
    const ix = leftX + Math.round((idealWeek[k]/100)*barW);
    tctx.strokeStyle="rgba(15,23,42,.55)";
    tctx.lineWidth=2;
    tctx.beginPath();
    tctx.moveTo(ix, y-4);
    tctx.lineTo(ix, y+18);
    tctx.stroke();

    // numbers
    tctx.fillStyle="rgba(15,23,42,.70)";
    tctx.font="800 12px ui-sans-serif, system-ui";
    tctx.textAlign="right";
    tctx.fillText(`hoje ${curWeek[k]}%  |  ideal ${idealWeek[k]}%`, W-14, y+18);
  });

  tctx.fillStyle="rgba(15,23,42,.70)";
  tctx.font="700 12px ui-sans-serif, system-ui";
  tctx.textAlign="left";
  tctx.fillText("Linha vertical = ideal. Barra colorida = hoje.", 14, H-16);
}

function drawBureau(B, friction){
  clear(bctx, bureau);
  const W = bureau.width, H = bureau.height;

  bctx.fillStyle="#fff";
  bctx.fillRect(0,0,W,H);

  bctx.fillStyle="rgba(15,23,42,.92)";
  bctx.font="950 16px ui-sans-serif, system-ui";
  bctx.fillText("Burocracia ‚Äî Term√¥metro + Fric√ß√£o", 14, 22);

  bctx.fillStyle="rgba(15,23,42,.65)";
  bctx.font="700 12px ui-sans-serif, system-ui";
  bctx.fillText("Burocracia √© atrito: quando sobe, drena foco e sa√∫de.", 14, 42);

  // thermometer
  const tx = 60, ty = 70, th = H-120, tw = 26;
  bctx.fillStyle="rgba(15,23,42,.06)";
  roundRect(bctx, tx, ty, tw, th, 12, true, false);

  const fillH = Math.round((B/100)*th);
  bctx.fillStyle = B>=70 ? "rgba(239,68,68,.75)" : (B>=40 ? "rgba(245,158,11,.80)" : "rgba(22,163,74,.75)");
  roundRect(bctx, tx, ty + (th - fillH), tw, fillH, 12, true, false);

  bctx.fillStyle="rgba(15,23,42,.80)";
  bctx.font="900 13px ui-sans-serif, system-ui";
  bctx.fillText(`‚ö´ Burocracia: ${B}/100`, 110, 100);

  // friction bar
  const bx = 110, by = 120, bw = W-150, bh = 18;
  bctx.fillStyle="rgba(15,23,42,.06)";
  roundRect(bctx, bx, by, bw, bh, 10, true, false);

  const fw = Math.round((friction/100)*bw);
  bctx.fillStyle = friction>=70 ? "rgba(239,68,68,.70)" : (friction>=40 ? "rgba(245,158,11,.75)" : "rgba(22,163,74,.70)");
  roundRect(bctx, bx, by, fw, bh, 10, true, false);

  bctx.fillStyle="rgba(15,23,42,.75)";
  bctx.font="900 12px ui-sans-serif, system-ui";
  bctx.fillText(`Fric√ß√£o percebida: ${friction}/100 (burocracia √ó limite toler√°vel)`, bx, by-8);

  // ‚ÄúDrenos principais‚Äù (explica√ß√£o fixa V2; depois podemos pedir sele√ß√£o)
  const drenos = [
    "Reuni√µes sem pauta/decis√£o",
    "Relat√≥rios duplicados e sistemas que n√£o conversam",
    "Presta√ß√£o de contas manual",
    "E-mails e urg√™ncias que invadem foco",
    "Comiss√µes por in√©rcia (ningu√©m tem coragem de encerrar)"
  ];

  bctx.fillStyle="rgba(15,23,42,.92)";
  bctx.font="950 13px ui-sans-serif, system-ui";
  bctx.fillText("Top drenos (o que normalmente mata a semana):", 110, 165);

  bctx.fillStyle="rgba(15,23,42,.70)";
  bctx.font="700 12px ui-sans-serif, system-ui";
  drenos.forEach((d, i)=>{
    bctx.fillText(`‚Ä¢ ${d}`, 110, 190 + i*18);
  });

  bctx.fillStyle="rgba(15,23,42,.80)";
  bctx.font="900 12px ui-sans-serif, system-ui";
  bctx.fillText("A√ß√£o imediata: escolha 1 dreno e crie template/automa√ß√£o/checklist em 48h.", 110, H-26);
}

function roundRect(ctx, x, y, w, h, r, fill, stroke){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

// ---------- UI: Tabs ----------
document.querySelectorAll(".tab[data-tab]").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab[data-tab]").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    const tab = t.dataset.tab;
    document.getElementById("tab-responder").style.display = (tab==="responder") ? "" : "none";
    document.getElementById("tab-metas").style.display = (tab==="metas") ? "" : "none";
    document.getElementById("tab-perguntas").style.display = (tab==="perguntas") ? "" : "none";
  });
});
document.querySelectorAll(".tab[data-rtab]").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab[data-rtab]").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    const tab = t.dataset.rtab;
    document.getElementById("rtab-resultados").style.display = (tab==="resultados") ? "" : "none";
    document.getElementById("rtab-planos").style.display = (tab==="planos") ? "" : "none";
  });
});

// ---------- Run ----------
const statusPill = document.getElementById("statusPill");

function run(){
  const data = compute();
  if(data.missing.length){
    statusPill.textContent = `faltam ${data.missing.length} respostas`;
    statusPill.style.background = "rgba(245,158,11,.12)";
    statusPill.style.borderColor = "rgba(245,158,11,.25)";
    document.getElementById("story").innerHTML =
      `Faltam respostas nas quest√µes: <b>${data.missing.join(", ")}</b>. V√° na aba <b>Perguntas</b> e complete.`;
    return;
  }

  const meta = buildNarrative(data);
  const moves = buildMoves(data, meta);
  const quotes = buildQuotes(data);

  // KPIs
  document.getElementById("kpiCore").textContent = `${EMOJI[meta.core]} ${LABEL[meta.core]}`;
  document.getElementById("kpiRisk").textContent = meta.rk.txt;
  document.getElementById("kpiRisk").style.color = clsColor(meta.rk.cls);

  // Story
  document.getElementById("story").innerHTML = meta.txt;

  // Quote block
  document.getElementById("quote").innerHTML =
    `<b>Tr√™s frases para voc√™ n√£o esquecer:</b><br>‚Ä¢ ${quotes[0]}<br>‚Ä¢ ${quotes[1]}<br>‚Ä¢ ${quotes[2]}`;

  // Plan
  const movesEl = document.getElementById("moves");
  movesEl.innerHTML = "";
  moves.forEach(m=>{
    const d = document.createElement("div");
    d.className = "move";
    d.innerHTML = `<p class="ttl">${m.ttl}</p><p class="txt">${m.txt}</p>`;
    movesEl.appendChild(d);
  });

  // Closing
  const closing = document.getElementById("closing");
  closing.innerHTML = `
    <div style="line-height:1.6;">
      <b>1)</b> Voc√™ √© respons√°vel por um <b>ecossistema</b>: conhecimento, pessoas, territ√≥rio e institui√ß√£o.<br>
      <b>2)</b> Seu recurso mais raro √© <b>aten√ß√£o</b> ‚Äî proteja-a com agenda e processos.<br>
      <b>3)</b> O professor universit√°rio maduro escolhe: <b>continuidade > novidade</b> e <b>coer√™ncia > oportunismo</b>.<br>
      <b>4)</b> Burocracia √© inevit√°vel, mas n√£o pode ser <b>identidade</b>.<br>
      <b>5)</b> O melhor docente n√£o faz tudo: ele <b>forma pessoas</b> e cria estruturas para o trabalho sobreviver ao seu nome.
    </div>
  `;

  // Draw graphs
  drawRadar(data.cur, {R:data.goal.R,E:data.goal.E,T:data.goal.T,G:data.goal.G,I:data.goal.I});
  drawTimeBars(data.currentWeek, data.ideal);
  drawBureau(data.cur.B, data.friction);

  statusPill.textContent = "diagn√≥stico gerado";
  statusPill.style.background = "rgba(22,163,74,.12)";
  statusPill.style.borderColor = "rgba(22,163,74,.25)";

  updateProgress();
}

document.getElementById("btnRun").addEventListener("click", run);
document.getElementById("btnRun2").addEventListener("click", run);

// ---------- Save/Load ----------
function collectState(){
  const answers = {};
  QUESTIONS.forEach(q=>{ answers[q.id] = document.getElementById(q.id).value || ""; });
  return {
    name: val("name"), uni: val("uni"), dept: val("dept"), prog: val("prog"),
    phase: val("phase"), hours: val("hours"), notes: val("notes"),
    goalR: val("goalR"), goalE: val("goalE"), goalT: val("goalT"),
    goalG: val("goalG"), goalI: val("goalI"), tolB: val("tolB"),
    idealR: val("idealR"), idealE: val("idealE"), idealT: val("idealT"),
    idealG: val("idealG"), idealI: val("idealI"), idealB: val("idealB"),
    answers
  };
}
function applyState(s){
  if(!s) return;
  setVal("name", s.name); setVal("uni", s.uni); setVal("dept", s.dept); setVal("prog", s.prog);
  setVal("phase", s.phase || "early"); setVal("hours", s.hours || 45); setVal("notes", s.notes || "");
  setVal("goalR", s.goalR ?? 70); setVal("goalE", s.goalE ?? 75); setVal("goalT", s.goalT ?? 70);
  setVal("goalG", s.goalG ?? 40); setVal("goalI", s.goalI ?? 60); setVal("tolB", s.tolB ?? 35);
  setVal("idealR", s.idealR ?? 25); setVal("idealE", s.idealE ?? 25); setVal("idealT", s.idealT ?? 25);
  setVal("idealG", s.idealG ?? 15); setVal("idealI", s.idealI ?? 10); setVal("idealB", s.idealB ?? 15);

  if(s.answers){
    Object.keys(s.answers).forEach(id=>{
      const el = document.getElementById(id);
      if(el){
        el.value = s.answers[id];
        // atualizar o visor do valor
        const vbox = el.parentElement.querySelector(".v");
        if(vbox) vbox.textContent = el.value ? el.value : "‚Äî";
      }
    });
  }
  updateProgress();
}
function val(id){ return document.getElementById(id).value; }
function setVal(id,v){ document.getElementById(id).value = (v ?? ""); }

document.getElementById("btnSave").addEventListener("click", ()=>{
  localStorage.setItem("eco_docente_v2", JSON.stringify(collectState()));
  statusPill.textContent = "salvo no navegador";
  statusPill.style.background = "rgba(37,99,235,.10)";
  statusPill.style.borderColor = "rgba(37,99,235,.20)";
});
document.getElementById("btnLoad").addEventListener("click", ()=>{
  const raw = localStorage.getItem("eco_docente_v2");
  if(!raw){
    statusPill.textContent = "nada salvo ainda";
    statusPill.style.background = "rgba(245,158,11,.12)";
    statusPill.style.borderColor = "rgba(245,158,11,.25)";
    return;
  }
  applyState(JSON.parse(raw));
  statusPill.textContent = "carregado";
  statusPill.style.background = "rgba(37,99,235,.10)";
  statusPill.style.borderColor = "rgba(37,99,235,.20)";
});

document.getElementById("btnReset").addEventListener("click", ()=>{
  localStorage.removeItem("eco_docente_v2");
  location.reload();
});

// ---------- Export image ----------
document.getElementById("btnExport").addEventListener("click", ()=>{
  const out = document.createElement("canvas");
  out.width = 1200;
  out.height = 980;
  const ctx = out.getContext("2d");

  ctx.fillStyle = "#ffffff";
  ctx.fillRect(0,0,out.width,out.height);

  ctx.fillStyle = "rgba(15,23,42,.95)";
  ctx.font = "950 28px ui-sans-serif, system-ui";
  ctx.fillText("Ecossistema Docente ‚Äî Diagn√≥stico (V2)", 24, 44);

  ctx.fillStyle = "rgba(15,23,42,.65)";
  ctx.font = "700 14px ui-sans-serif, system-ui";
  const name = (val("name")||"Visitante").trim();
  const uni  = (val("uni")||"‚Äî").trim();
  ctx.fillText(`${name} ¬∑ ${uni} ¬∑ ${new Date().toLocaleDateString()}`, 24, 68);

  // grids
  ctx.drawImage(radar, 24, 90, 560, 320);
  ctx.drawImage(timeBars, 616, 90, 560, 320);
  ctx.drawImage(bureau, 24, 430, 1152, 260);

  // add short story
  ctx.fillStyle = "rgba(15,23,42,.92)";
  ctx.font = "900 14px ui-sans-serif, system-ui";
  ctx.fillText("Resumo:", 24, 720);

  ctx.fillStyle = "rgba(15,23,42,.70)";
  ctx.font = "700 13px ui-sans-serif, system-ui";
  const story = document.getElementById("story").innerText.replace(/\s+/g," ").trim();
  wrapText(ctx, story.slice(0, 520) + (story.length>520 ? "‚Ä¶" : ""), 24, 744, 1152, 18);

  const link = document.createElement("a");
  link.download = "ecossistema-docente-v2.png";
  link.href = out.toDataURL("image/png");
  link.click();
});

function wrapText(ctx, text, x, y, maxWidth, lineHeight){
  const words = text.split(" ");
  let line = "";
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + " ";
    const metrics = ctx.measureText(testLine);
    if(metrics.width > maxWidth && n>0){
      ctx.fillText(line, x, y);
      line = words[n] + " ";
      y += lineHeight;
    } else line = testLine;
  }
  ctx.fillText(line, x, y);
}

// init
buildQuiz();
updateProgress();
drawRadar({R:0,E:0,T:0,G:0,I:0},{R:0,E:0,T:0,G:0,I:0});
drawTimeBars({R:0,E:0,T:0,G:0,I:0,B:0},{R:0,E:0,T:0,G:0,I:0,B:0});
drawBureau(0,0);

// load if exists
const saved = localStorage.getItem("eco_docente_v2");
if(saved) applyState(JSON.parse(saved));
</script>
</body>
</html>
