<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ecossistema Docente â€” V3 (DiagnÃ³stico + Debate)</title>
  <style>
    :root{
      /* Visual claro, elegante, sem â€œnoiteâ€ */
      --bg0:#f6f7fb;
      --bg1:#eef2ff;
      --card:#ffffff;
      --stroke: rgba(17,24,39,.10);
      --txt:#0f172a;
      --muted: rgba(15,23,42,.70);

      --accent:#2563eb;
      --accent2:#7c3aed;

      --r:#2563eb; /* pesquisa */
      --e:#16a34a; /* extensÃ£o */
      --t:#f59e0b; /* ensino */
      --g:#7c3aed; /* gestÃ£o */
      --i:#ef4444; /* inovaÃ§Ã£o */
      --b:#475569; /* burocracia */
      --m:#0ea5e9; /* saÃºde mental */

      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;

      --shadow: 0 12px 34px rgba(15,23,42,.10);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 760px at 15% 10%, rgba(37,99,235,.10) 0%, transparent 55%),
        radial-gradient(1000px 720px at 85% 15%, rgba(124,58,237,.10) 0%, transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--txt);
    }

    header{
      max-width:1250px;
      margin:0 auto;
      padding:18px 16px 10px;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:46px; height:46px; border-radius:14px;
      background: linear-gradient(135deg, rgba(37,99,235,.22), rgba(124,58,237,.18));
      border:1px solid rgba(15,23,42,.10);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .logo:before{
      content:"";
      position:absolute; inset:-20px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 45%);
      transform: rotate(12deg);
    }

    h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    .subtitle{
      margin:4px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      max-width:820px;
    }

    .top-actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button{
      background: #fff;
      border: 1px solid rgba(15,23,42,.12);
      color: var(--txt);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: .15s transform, .15s box-shadow, .15s background;
      font-weight: 850;
      box-shadow: 0 6px 18px rgba(15,23,42,.06);
    }
    button:hover{ transform: translateY(-1px); box-shadow: 0 10px 24px rgba(15,23,42,.10); }
    button:active{ transform: translateY(0px); }
    .primary{
      background: linear-gradient(135deg, rgba(37,99,235,.14), rgba(124,58,237,.12));
      border-color: rgba(37,99,235,.18);
    }
    .danger{
      background: rgba(239,68,68,.10);
      border-color: rgba(239,68,68,.20);
    }

    main{
      max-width:1250px;
      margin:0 auto;
      padding:0 16px 44px;
      display:grid; gap:14px;
      grid-template-columns: 1.08fr .92fr;
    }
    @media (max-width: 980px){ main{ grid-template-columns:1fr; } }

    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-h{
      padding:14px 14px 10px;
      border-bottom: 1px solid rgba(15,23,42,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    .card-h h2{
      margin:0; font-size:14px; letter-spacing:.2px;
      display:flex; gap:10px; align-items:center;
    }
    .pill{
      font-size:12px; color: rgba(15,23,42,.72);
      padding:6px 10px; border-radius:999px;
      background: rgba(15,23,42,.04);
      border: 1px solid rgba(15,23,42,.08);
    }
    .card-b{ padding:14px; }

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:10px 14px 0;
    }
    .tab{
      padding:8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.03);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      user-select:none;
    }
    .tab.active{
      background: rgba(37,99,235,.10);
      border-color: rgba(37,99,235,.20);
    }

    .grid2{ display:grid; gap:10px; grid-template-columns: 1fr 1fr; }
    @media (max-width:700px){ .grid2{ grid-template-columns:1fr; } }

    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input, select, textarea{
      width:100%;
      background: #fff;
      border: 1px solid rgba(15,23,42,.14);
      color: var(--txt);
      padding:10px 12px;
      border-radius: 12px;
      outline:none;
    }
    textarea{ min-height:84px; resize:vertical; }

    .q{
      padding:12px;
      border-radius: 14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
      margin-bottom:10px;
    }
    .q-title{
      font-weight: 950;
      margin:0 0 8px;
      line-height:1.35;
      font-size:13px;
    }
    .q-sub{
      margin:0 0 10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .scale{ display:flex; align-items:center; gap:10px; }
    .scale input[type="range"]{ flex:1; accent-color: rgba(37,99,235,.9); }
    .scale .v{
      min-width:40px;
      text-align:center;
      font-weight:950;
      background: rgba(15,23,42,.05);
      border:1px solid rgba(15,23,42,.10);
      border-radius: 10px;
      padding:6px 8px;
    }
    .scaleHints{
      display:flex; justify-content:space-between;
      font-size:11px; color:var(--muted);
      margin-top:6px;
    }

    .bar{
      height:10px; border-radius:999px;
      background: rgba(15,23,42,.07);
      border: 1px solid rgba(15,23,42,.10);
      overflow:hidden;
    }
    .bar > i{
      display:block; height:100%; width:0%;
      background: linear-gradient(90deg, rgba(37,99,235,.85), rgba(124,58,237,.75));
    }

    .kpis{
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
    }
    .kpi{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
    }
    .kpi .v{ font-size:20px; font-weight:990; }
    .kpi .l{ font-size:12px; color:var(--muted); margin-top:2px; line-height:1.3; }

    .story{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
      line-height:1.6;
      font-size:13px;
      color: rgba(15,23,42,.92);
    }
    .quote{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      border:1px dashed rgba(15,23,42,.18);
      background: rgba(37,99,235,.05);
      font-size:13px;
      line-height:1.55;
    }

    /* âœ… CANVAS sem deformar: altura via aspect-ratio e resize real em JS */
    .vizGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:980px){ .vizGrid{ grid-template-columns:1fr; } }

    .viz{
      border-radius: 16px;
      border:1px solid rgba(15,23,42,.10);
      background: #fff;
      padding:10px;
    }
    .viz h3{
      margin:0 0 8px;
      font-size:13px;
      font-weight:980;
      letter-spacing:.1px;
      color: rgba(15,23,42,.92);
      display:flex; gap:8px; align-items:center;
    }
    .viz p{
      margin:0 0 10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .canvasWrap{
      position:relative;
      width:100%;
      aspect-ratio: 16 / 9;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
    }
    canvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      display:block;
    }

    .micro{ display:grid; gap:10px; margin-top:10px; }
    .move{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.10);
      background: #fff;
    }
    .move .ttl{ font-weight:990; margin:0 0 4px; }
    .move .txt{ margin:0; color:var(--muted); font-size:12px; line-height:1.45; }

    /* âœ… Checklist elegante e grande */
    .checkGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:980px){ .checkGrid{ grid-template-columns:1fr; } }

    .checkCard{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(15,23,42,.02);
    }
    .checkCard h3{
      margin:0 0 8px;
      font-size:13px;
      font-weight:990;
      display:flex; gap:8px; align-items:center;
    }
    .checkCard .hint{
      margin:0 0 10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
    }
    .ck{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:8px 10px;
      border-radius: 12px;
      background: #fff;
      border:1px solid rgba(15,23,42,.08);
      margin:8px 0;
    }
    .ck input{
      width:18px; height:18px;
      margin-top:2px;
      accent-color: rgba(37,99,235,.90);
    }
    .ck .txt{
      font-size:13px;
      line-height:1.35;
      color: rgba(15,23,42,.92);
    }
    .ck .txt b{ font-weight:990; }

    .tagrow{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
      color:var(--muted); font-size:12px;
    }
    .tag{
      display:flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      background: rgba(15,23,42,.03);
      border:1px solid rgba(15,23,42,.08);
    }
    .dot{ width:10px; height:10px; border-radius:999px; background:#111; }

    .small{
      font-size:12px; color:var(--muted);
      margin-top:8px;
      line-height:1.35;
    }
  </style>
</head>

<body>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Ecossistema Docente â€” V3 (DiagnÃ³stico visual + plano executÃ¡vel)</h1>
      <p class="subtitle">
        Um game crÃ­tico para professores: <b>o que eu faÃ§o</b>, <b>o que eu quero ser</b> e <b>o que me captura</b>.
        Aqui, burocracia e saÃºde mental nÃ£o sÃ£o â€œrodapÃ©â€: sÃ£o eixo.
      </p>
    </div>
  </div>

  <div class="top-actions">
    <button class="primary" id="btnRun">Gerar diagnÃ³stico</button>
    <button id="btnSave">Salvar</button>
    <button id="btnLoad">Carregar</button>
    <button id="btnExport">Exportar painel</button>
    <button class="danger" id="btnReset">Resetar</button>
  </div>
</header>

<main>
  <!-- ESQUERDA -->
  <section class="card">
    <div class="tabs">
      <div class="tab active" data-tab="responder">Responder</div>
      <div class="tab" data-tab="metas">Metas</div>
      <div class="tab" data-tab="perguntas">Perguntas</div>
    </div>

    <div id="tab-responder">
      <div class="card-h">
        <h2>ğŸ§¾ Identidade & contexto</h2>
        <span class="pill">V3 â€” grÃ¡ficos estÃ¡veis (sem deformar)</span>
      </div>
      <div class="card-b">
        <div class="grid2">
          <div><label>Nome</label><input id="name" placeholder="Ex.: Ernandes"/></div>
          <div><label>Universidade</label><input id="uni" placeholder="Ex.: UNEMAT"/></div>
          <div><label>Departamento</label><input id="dept" placeholder="Ex.: CiÃªncias Ambientais"/></div>
          <div><label>Programa(s)</label><input id="prog" placeholder="Ex.: PPGCA, PPGEO..."/></div>

          <div>
            <label>Fase da carreira</label>
            <select id="phase">
              <option value="early">InÃ­cio (0â€“5 anos)</option>
              <option value="mid">Meio (6â€“15 anos)</option>
              <option value="senior">SÃªnior (16+ anos)</option>
            </select>
          </div>

          <div><label>Horas â€œreaisâ€ por semana</label><input id="hours" type="number" min="1" max="120" value="45"/></div>
        </div>

        <div style="margin-top:12px;">
          <label>O que mais te puxa hoje? (opcional)</label>
          <textarea id="notes" placeholder="Ex.: reuniÃµes, sistemas, falta de equipe, pressÃ£o por papers, orientaÃ§Ãµes, comissÃµes, etc."></textarea>
        </div>

        <div style="margin-top:12px;">
          <div class="bar"><i id="pbar"></i></div>
          <div class="small">Progresso: <b><span id="answered">0</span>/<span id="totalQ">0</span></b> respondidas.</div>
        </div>
      </div>
    </div>

    <div id="tab-metas" style="display:none;">
      <div class="card-h">
        <h2>ğŸ¯ Metas em 5 anos</h2>
        <span class="pill">defina seu norte (0â€“100)</span>
      </div>
      <div class="card-b">
        <div class="grid2">
          <div><label>Pesquisa ğŸ”¬</label><input id="goalR" type="number" min="0" max="100" value="70"></div>
          <div><label>ExtensÃ£o ğŸŒ±</label><input id="goalE" type="number" min="0" max="100" value="75"></div>
          <div><label>Ensino ğŸ“</label><input id="goalT" type="number" min="0" max="100" value="70"></div>
          <div><label>GestÃ£o ğŸ§­</label><input id="goalG" type="number" min="0" max="100" value="40"></div>
          <div><label>InovaÃ§Ã£o ğŸš€</label><input id="goalI" type="number" min="0" max="100" value="60"></div>
          <div><label>Limite de burocracia aceitÃ¡vel (0â€“100)</label><input id="tolB" type="number" min="0" max="100" value="35"></div>
        </div>

        <div style="margin-top:12px;">
          <label>Limite de carga mental tolerÃ¡vel (0â€“100)</label>
          <input id="tolM" type="number" min="0" max="100" value="45">
          <div class="small">
            Isso serve para o app mostrar: â€œvocÃª estÃ¡ acima do que considera sustentÃ¡vel?â€.
          </div>
        </div>
      </div>

      <div class="card-h">
        <h2>ğŸ•°ï¸ Seu â€œideal de semanaâ€ (distribuiÃ§Ã£o %)</h2>
        <span class="pill">o app normaliza a soma</span>
      </div>
      <div class="card-b">
        <div class="grid2">
          <div><label>% Pesquisa</label><input id="idealR" type="number" min="0" max="100" value="25"></div>
          <div><label>% ExtensÃ£o</label><input id="idealE" type="number" min="0" max="100" value="25"></div>
          <div><label>% Ensino</label><input id="idealT" type="number" min="0" max="100" value="25"></div>
          <div><label>% GestÃ£o</label><input id="idealG" type="number" min="0" max="100" value="15"></div>
          <div><label>% InovaÃ§Ã£o</label><input id="idealI" type="number" min="0" max="100" value="10"></div>
          <div><label>% Burocracia (mÃ¡x.)</label><input id="idealB" type="number" min="0" max="100" value="15"></div>
        </div>
      </div>
    </div>

    <div id="tab-perguntas" style="display:none;">
      <div class="card-h">
        <h2>ğŸ§  Perguntas (rÃ©gua 1â€“5) â€” pesos ocultos</h2>
        <span class="pill">menos â€œquizâ€, mais espelho</span>
      </div>
      <div class="card-b" id="quiz"></div>
      <div class="card-b">
        <button class="primary" id="btnRun2">Gerar diagnÃ³stico</button>
        <div class="small">
          Regra do jogo: responda como vocÃª age <b>sob pressÃ£o</b>.
          Se responder como â€œidealâ€, vocÃª nÃ£o verÃ¡ o sistema te capturando.
        </div>
      </div>
    </div>
  </section>

  <!-- DIREITA -->
  <aside class="card">
    <div class="tabs">
      <div class="tab active" data-rtab="resultados">Resultados</div>
      <div class="tab" data-rtab="plano">Plano</div>
      <div class="tab" data-rtab="check">Checklist</div>
    </div>

    <div id="rtab-resultados">
      <div class="card-h">
        <h2>ğŸ“ Painel visual (robusto e legÃ­vel)</h2>
        <span class="pill" id="statusPill">aguardandoâ€¦</span>
      </div>
      <div class="card-b">

        <div class="vizGrid">
          <div class="viz">
            <h3>ğŸ•¸ï¸ Perfil (Atual vs Desejado)</h3>
            <p>DistribuiÃ§Ã£o de energia por eixo. NÃ£o mede â€œqualidadeâ€. Mede <b>onde vocÃª vive</b>.</p>
            <div class="canvasWrap"><canvas id="cvRadar"></canvas></div>
            <div class="tagrow">
              <span class="tag"><i class="dot" style="background:rgba(15,23,42,.90)"></i> Atual</span>
              <span class="tag"><i class="dot" style="background:rgba(15,23,42,.25)"></i> Desejado</span>
            </div>
          </div>

          <div class="viz">
            <h3>ğŸ“Š Semana (Hoje vs Ideal)</h3>
            <p>VocÃª vÃª o desvio em segundos. Linha = ideal. Barra = hoje.</p>
            <div class="canvasWrap"><canvas id="cvWeek"></canvas></div>
          </div>

          <div class="viz">
            <h3>âš« Burocracia (termÃ´metro + fricÃ§Ã£o)</h3>
            <p>Quando isso sobe, o resto vira sobrevivÃªncia. Sem romantizar.</p>
            <div class="canvasWrap"><canvas id="cvBureau"></canvas></div>
          </div>

          <div class="viz">
            <h3>ğŸ§  SaÃºde mental (carga + risco)</h3>
            <p>Indicador de â€œcapturaâ€: se vocÃª sÃ³ apaga incÃªndio, nada floresce.</p>
            <div class="canvasWrap"><canvas id="cvMental"></canvas></div>
          </div>

          <div class="viz">
            <h3>ğŸ§­ Impacto Ã— Energia</h3>
            <p>Quadrante para decidir: o que dÃ¡ retorno (impacto) sem te destruir (energia).</p>
            <div class="canvasWrap"><canvas id="cvQuad"></canvas></div>
          </div>

          <div class="viz">
            <h3>â³ Funil de drenos da semana</h3>
            <p>Uma visÃ£o simples do que rouba o seu melhor horÃ¡rio cognitivo.</p>
            <div class="canvasWrap"><canvas id="cvFunnel"></canvas></div>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card-h" style="border:0; padding:0 0 10px;">
          <h2>ğŸ“Œ DiagnÃ³stico narrativo</h2>
          <span class="pill">com criticidade</span>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="v" id="kpiCore">â€”</div>
            <div class="l">Seu eixo dominante hoje</div>
          </div>
          <div class="kpi">
            <div class="v" id="kpiRisk">â€”</div>
            <div class="l">Risco de captura (burocracia + carga mental)</div>
          </div>
        </div>

        <div style="height:10px"></div>
        <div class="story" id="story">Responda e gere o diagnÃ³stico.</div>
        <div class="quote" id="quote"></div>
      </div>
    </div>

    <div id="rtab-plano" style="display:none;">
      <div class="card-h">
        <h2>ğŸ§­ Plano (7 / 30 / 90 dias)</h2>
        <span class="pill">executÃ¡vel</span>
      </div>
      <div class="card-b">
        <div class="micro" id="moves"></div>
      </div>
    </div>

    <div id="rtab-check" style="display:none;">
      <div class="card-h">
        <h2>âœ… Checklist grande (bonito e Ãºtil)</h2>
        <span class="pill">marque e volte amanhÃ£</span>
      </div>
      <div class="card-b">
        <div class="checkGrid" id="checkGrid"></div>

        <div class="checkCard" style="margin-top:12px;">
          <h3>ğŸ§© O que Ã© ser professor universitÃ¡rio (para fechar)</h3>
          <p class="hint">Frases para imprimir/colocar no app como â€œmanifestoâ€ (sem autoajuda).</p>
          <div id="closing"></div>
        </div>
      </div>
    </div>
  </aside>
</main>

<script>
/* =========================
   DADOS
========================= */
const EMOJI = {R:"ğŸ”¬",E:"ğŸŒ±",T:"ğŸ“",G:"ğŸ§­",I:"ğŸš€",B:"âš«",M:"ğŸ§ "};
const LABEL = {R:"Pesquisa",E:"ExtensÃ£o",T:"Ensino",G:"GestÃ£o",I:"InovaÃ§Ã£o",B:"Burocracia",M:"SaÃºde mental"};

const COLORS = {
  R:"rgba(37,99,235,.85)",
  E:"rgba(22,163,74,.82)",
  T:"rgba(245,158,11,.88)",
  G:"rgba(124,58,237,.82)",
  I:"rgba(239,68,68,.78)",
  B:"rgba(71,85,105,.75)",
  M:"rgba(14,165,233,.78)",
  ink:"rgba(15,23,42,.92)",
  soft:"rgba(15,23,42,.10)",
  soft2:"rgba(15,23,42,.06)"
};

const QUESTIONS = [
  /* Pesquisa / autoria */
  { id:"q1",  t:"Eu uso meus prÃ³prios artigos e projetos como material vivo de aula (com mÃ©todo e crÃ­tica).", a:"Nunca", b:"Sempre", w:{R:1.2,T:1.0} },
  { id:"q2",  t:"Eu tenho rotina de escrita/produÃ§Ã£o que sobrevive Ã  semana real.", a:"Nunca", b:"Sempre", w:{R:1.5,G:0.2,M:-0.2} },
  { id:"q3",  t:"Minha pesquisa tem uma pergunta-mÃ£e que dÃ¡ coerÃªncia aos projetos (evita dispersÃ£o por edital).", a:"Nada", b:"Totalmente", w:{R:1.4,G:0.2,M:-0.2} },

  /* ExtensÃ£o crÃ­tica */
  { id:"q4",  t:"Eu enxergo extensÃ£o como coproduÃ§Ã£o de conhecimento (nÃ£o sÃ³ evento).", a:"Nada", b:"Totalmente", w:{E:1.3,R:0.4} },
  { id:"q5",  t:"Eu consigo transformar extensÃ£o em processo contÃ­nuo com indicadores simples e parceiros fixos.", a:"Nunca", b:"Sempre", w:{E:1.4,G:0.6} },

  /* Ensino contemporÃ¢neo + inclusÃ£o */
  { id:"q6",  t:"Eu preparo aulas considerando neurodivergÃªncia (TDAH/TEA) com estrutura e mÃºltiplas formas de participaÃ§Ã£o.", a:"Nunca", b:"Sempre", w:{T:1.2,M:-0.1} },
  { id:"q7",  t:"Eu adapto materiais para acessibilidade (surdos/cegos/baixa visÃ£o/dislexia) ou busco apoio para isso.", a:"Nada", b:"Muito", w:{T:1.2,G:0.3,B:0.1} },
  { id:"q8",  t:"AvaliaÃ§Ã£o Ã© formativa (feedback, rubricas, refaÃ§Ã£o), nÃ£o puniÃ§Ã£o nem burocracia.", a:"Nunca", b:"Sempre", w:{T:1.3,B:-0.2,M:-0.1} },

  /* IA + inovaÃ§Ã£o */
  { id:"q9",  t:"Eu uso IA de modo Ã©tico/pedagÃ³gico e ensino limites e transparÃªncia.", a:"Nunca", b:"Sempre", w:{I:1.0,T:0.6,G:0.2} },
  { id:"q10", t:"Eu tenho polÃ­tica clara para IA na disciplina (o que pode, como declarar e citar uso).", a:"Nunca", b:"Sempre", w:{G:0.6,T:0.8} },
  { id:"q11", t:"Eu transformo ideias em protÃ³tipos e valido com usuÃ¡rios (alunos/territÃ³rio/gestÃ£o) antes de â€œfecharâ€ soluÃ§Ã£o.", a:"Nunca", b:"Sempre", w:{I:1.4,E:0.2} },
  { id:"q12", t:"Eu institucionalizo o que crio (documento, treino pessoas, deixo replicÃ¡vel).", a:"Nunca", b:"Sempre", w:{G:0.8,I:0.8} },

  /* GestÃ£o e polÃ­tica universitÃ¡ria */
  { id:"q13", t:"Eu entendo a universidade como campo de disputa (tempo/recursos/prestÃ­gio) e ajo com estratÃ©gia sem perder valores.", a:"Nada", b:"Totalmente", w:{G:1.0,B:0.2} },
  { id:"q14", t:"Eu lido com autoria/crÃ©ditos/hierarquias com firmeza e Ã©tica (sem virar cÃ­nico).", a:"Nunca", b:"Sempre", w:{G:0.9,M:-0.1} },
  { id:"q15", t:"Eu formo pessoas para serem melhores que eu (delegaÃ§Ã£o com confianÃ§a + critÃ©rio).", a:"Nunca", b:"Sempre", w:{G:0.8,T:0.6,E:0.3} },

  /* Burocracia real */
  { id:"q16", t:"Minha semana Ã© engolida por sistemas, formulÃ¡rios, relatÃ³rios duplicados e reuniÃµes sem decisÃ£o.", a:"Nada", b:"Totalmente", w:{B:1.7,M:0.4} },
  { id:"q17", t:"ReuniÃµes ocupam meu melhor horÃ¡rio cognitivo.", a:"Nunca", b:"Sempre", w:{B:1.2,M:0.4} },
  { id:"q18", t:"Eu automatizo/templatizo rotinas (relatÃ³rios, e-mails, fluxos) para nÃ£o repetir dor.", a:"Nunca", b:"Sempre", w:{I:0.6,G:0.6,B:-0.7,M:-0.2} },
  { id:"q19", t:"Eu consigo dizer â€œnÃ£oâ€ de modo institucionalmente inteligente quando a demanda sÃ³ gera ruÃ­do.", a:"Nunca", b:"Sempre", w:{G:0.7,B:-0.9,M:-0.2} },

  /* SaÃºde mental (sem romantizar) */
  { id:"q20", t:"Eu durmo o suficiente e nÃ£o trabalho sempre no modo â€˜urgÃªnciaâ€™ (meu corpo nÃ£o virou ferramenta).", a:"Nunca", b:"Sempre", w:{M:-0.9,B:-0.1,G:0.2} },
  { id:"q21", t:"Eu reconheÃ§o sinais de exaustÃ£o e ajusto o sistema (nÃ£o sÃ³ â€˜aguentoâ€™).", a:"Nunca", b:"Sempre", w:{G:0.6,M:-0.7,B:-0.2} },
  { id:"q22", t:"Eu protejo blocos de foco profundo (90â€“120 min) pelo menos 2x por semana.", a:"Nunca", b:"Sempre", w:{R:0.7,T:0.5,I:0.5,B:-0.4,M:-0.2} }
];

document.getElementById("totalQ").textContent = QUESTIONS.length;

/* =========================
   QUIZ UI
========================= */
const quizEl = document.getElementById("quiz");

function buildQuiz(){
  quizEl.innerHTML="";
  QUESTIONS.forEach((q, idx)=>{
    const wrap = document.createElement("div");
    wrap.className = "q";

    wrap.innerHTML = `
      <p class="q-title">${idx+1}) ${q.t}</p>
      <p class="q-sub">Use a rÃ©gua: 1 (discordo/ausente) â†’ 5 (concordo/presente). As pontuaÃ§Ãµes ficam ocultas.</p>
      <div class="scale">
        <input type="range" min="1" max="5" step="1" id="${q.id}">
        <div class="v" id="${q.id}_v">â€”</div>
      </div>
      <div class="scaleHints"><span>${q.a}</span><span>${q.b}</span></div>
    `;

    const rng = wrap.querySelector(`#${q.id}`);
    const valBox = wrap.querySelector(`#${q.id}_v`);
    rng.addEventListener("input", ()=>{
      valBox.textContent = rng.value;
      updateProgress();
    });

    quizEl.appendChild(wrap);
  });
}
buildQuiz();

/* =========================
   PROGRESS
========================= */
function countAnswered(){
  let n=0;
  QUESTIONS.forEach(q=>{
    const v = document.getElementById(q.id).value;
    if(v && Number(v)>=1) n++;
  });
  return n;
}
function updateProgress(){
  const n = countAnswered();
  document.getElementById("answered").textContent = n;
  const pct = Math.round((n/QUESTIONS.length)*100);
  document.getElementById("pbar").style.width = pct + "%";
}
updateProgress();

function clampNum(id, min=0, max=100){
  const el = document.getElementById(id);
  let v = Number(el.value);
  if(!Number.isFinite(v)) v = 0;
  v = Math.max(min, Math.min(max, Math.round(v)));
  el.value = v;
  return v;
}
function normalize100(obj){
  const sum = Object.values(obj).reduce((a,b)=>a+b,0);
  const base = Math.max(1, sum);
  const out={};
  for(const k in obj) out[k] = Math.round((obj[k]/base)*100);
  return out;
}

/* =========================
   COMPUTE
========================= */
function compute(){
  const missing=[];
  const raw = {R:0,E:0,T:0,G:0,I:0,B:0,M:0};

  QUESTIONS.forEach((q, idx)=>{
    const v = Number(document.getElementById(q.id).value);
    if(!Number.isFinite(v) || v<1){ missing.push(idx+1); return; }
    const x = (v-1)/4; // 0..1
    for(const k in q.w){
      raw[k] += x * q.w[k];
    }
  });

  // Perfil (R,E,T,G,I) normalizado
  const mainKeys=["R","E","T","G","I"];
  const mainSum = mainKeys.reduce((a,k)=>a + Math.max(0,raw[k]), 0);
  const base = Math.max(0.0001, mainSum);
  const cur = {
    R: Math.round((Math.max(0,raw.R)/base)*100),
    E: Math.round((Math.max(0,raw.E)/base)*100),
    T: Math.round((Math.max(0,raw.T)/base)*100),
    G: Math.round((Math.max(0,raw.G)/base)*100),
    I: Math.round((Math.max(0,raw.I)/base)*100),
    // B e M em 0..100 por heurÃ­stica (escala ajustada)
    B: Math.max(0, Math.min(100, Math.round((raw.B + 1.4) * 30))),
    M: Math.max(0, Math.min(100, Math.round((raw.M + 1.2) * 30)))
  };

  const goal = {
    R: clampNum("goalR"), E: clampNum("goalE"), T: clampNum("goalT"),
    G: clampNum("goalG"), I: clampNum("goalI"),
    tolB: clampNum("tolB"),
    tolM: clampNum("tolM")
  };

  const ideal = normalize100({
    R: clampNum("idealR"), E: clampNum("idealE"), T: clampNum("idealT"),
    G: clampNum("idealG"), I: clampNum("idealI"), B: clampNum("idealB")
  });

  // Semana â€œatualâ€ (heurÃ­stica: perfil + burocracia drena)
  let currentWeek = {
    R: cur.R, E: cur.E, T: cur.T, G: cur.G, I: cur.I,
    B: Math.min(45, Math.max(10, Math.round(cur.B*0.42)))
  };
  currentWeek = normalize100(currentWeek);

  // FricÃ§Ãµes: quanto estÃ¡ acima do tolerÃ¡vel
  const frictionB = Math.max(0, Math.round((cur.B - goal.tolB)));
  const frictionM = Math.max(0, Math.round((cur.M - goal.tolM)));
  const capture = Math.min(100, Math.round((cur.B*0.45) + (cur.M*0.40) + (frictionB*0.10) + (frictionM*0.05)));

  const gap = {
    R: goal.R - cur.R,
    E: goal.E - cur.E,
    T: goal.T - cur.T,
    G: goal.G - cur.G,
    I: goal.I - cur.I
  };

  // â€œimpactoâ€ e â€œenergiaâ€ por eixo (para quadrante) â€” heurÃ­stica Ãºtil
  const impact = {R:cur.R*0.9 + goal.R*0.1, E:cur.E*0.8 + goal.E*0.2, T:cur.T*0.85 + goal.T*0.15, G:cur.G*0.7 + goal.G*0.3, I:cur.I*0.8 + goal.I*0.2};
  const energy = {
    R: Math.max(10, 60 - cur.B*0.2 - cur.M*0.25),
    E: Math.max(10, 58 - cur.B*0.2 - cur.M*0.18),
    T: Math.max(10, 55 - cur.B*0.18 - cur.M*0.22),
    G: Math.max(10, 50 - cur.B*0.10 - cur.M*0.12),
    I: Math.max(10, 56 - cur.B*0.18 - cur.M*0.16)
  };

  return {missing, raw, cur, goal, ideal, currentWeek, frictionB, frictionM, capture, gap, impact, energy};
}

function topRole(vec){
  const keys=["R","E","T","G","I"];
  return keys.reduce((best,k)=> vec[k] > vec[best] ? k : best, "R");
}
function riskLabel(capture){
  if(capture >= 70) return {txt:"ALTO ğŸ”¥", cls:"bad"};
  if(capture >= 40) return {txt:"MÃ‰DIO âš ï¸", cls:"warn"};
  return {txt:"BAIXO âœ…", cls:"ok"};
}
function clsColor(cls){
  return cls==="bad" ? "var(--bad)" : (cls==="warn" ? "var(--warn)" : "var(--ok)");
}
function phaseTxt(){
  const p = document.getElementById("phase").value;
  return p==="early" ? "inÃ­cio de carreira" : (p==="mid" ? "meio de carreira" : "fase sÃªnior");
}

/* =========================
   CANVAS ENGINE (SEM DEFORMAR)
========================= */
function setupCanvas(canvas){
  const ctx = canvas.getContext("2d");
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    const w = Math.max(10, Math.round(rect.width * dpr));
    const h = Math.max(10, Math.round(rect.height * dpr));
    if(canvas.width !== w || canvas.height !== h){
      canvas.width = w;
      canvas.height = h;
    }
    ctx.setTransform(dpr,0,0,dpr,0,0); // desenhar em CSS pixels
  }
  return {ctx, resize};
}

const C = {
  radar: setupCanvas(document.getElementById("cvRadar")),
  week: setupCanvas(document.getElementById("cvWeek")),
  bureau: setupCanvas(document.getElementById("cvBureau")),
  mental: setupCanvas(document.getElementById("cvMental")),
  quad: setupCanvas(document.getElementById("cvQuad")),
  funnel: setupCanvas(document.getElementById("cvFunnel"))
};

function clear(ctx, canvas){
  const w = canvas.getBoundingClientRect().width;
  const h = canvas.getBoundingClientRect().height;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle = "#fff";
  ctx.fillRect(0,0,w,h);
}

function roundRect(ctx, x,y,w,h,r, fill=true, stroke=false){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr,y);
  ctx.arcTo(x+w,y,x+w,y+h,rr);
  ctx.arcTo(x+w,y+h,x,y+h,rr);
  ctx.arcTo(x,y+h,x,y,rr);
  ctx.arcTo(x,y,x+w,y,rr);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

function drawRadar(cur, goal){
  const canvas = document.getElementById("cvRadar");
  const {ctx, resize} = C.radar;
  resize();
  clear(ctx, canvas);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const cx = W*0.50, cy = H*0.56;
  const radius = Math.min(W*0.34, H*0.40);
  const axes = ["R","E","T","G","I"];
  const n = axes.length;

  // rings
  ctx.strokeStyle = COLORS.soft;
  ctx.lineWidth = 1;
  for(let r=1;r<=5;r++){
    const rr = radius*(r/5);
    ctx.beginPath();
    for(let i=0;i<n;i++){
      const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
      const x = cx + Math.cos(ang)*rr;
      const y = cy + Math.sin(ang)*rr;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.closePath(); ctx.stroke();
  }

  // axes + labels
  axes.forEach((k,i)=>{
    const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
    const x = cx + Math.cos(ang)*radius;
    const y = cy + Math.sin(ang)*radius;
    ctx.beginPath();
    ctx.moveTo(cx,cy); ctx.lineTo(x,y);
    ctx.strokeStyle = "rgba(15,23,42,.12)";
    ctx.stroke();

    const lx = cx + Math.cos(ang)*(radius+22);
    const ly = cy + Math.sin(ang)*(radius+22);
    ctx.fillStyle = COLORS.ink;
    ctx.font = "900 12px ui-sans-serif, system-ui";
    ctx.textAlign = "center";
    ctx.fillText(`${EMOJI[k]} ${LABEL[k]}`, lx, ly+4);
  });

  function poly(vec, stroke, fill){
    ctx.beginPath();
    axes.forEach((k,i)=>{
      const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
      const val = (vec[k]||0)/100;
      const x = cx + Math.cos(ang)*radius*val;
      const y = cy + Math.sin(ang)*radius*val;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.closePath();
    ctx.strokeStyle = stroke; ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = fill;
    ctx.fill();
  }

  poly(goal, "rgba(15,23,42,.25)", "rgba(15,23,42,.06)");
  poly(cur, "rgba(15,23,42,.90)", "rgba(15,23,42,.12)");

  // title
  ctx.fillStyle = COLORS.ink;
  ctx.font = "950 13px ui-sans-serif, system-ui";
  ctx.textAlign="left";
  ctx.fillText("Atual vs Desejado", 10, 18);
}

function drawWeekBars(curW, idealW){
  const canvas = document.getElementById("cvWeek");
  const {ctx, resize} = C.week;
  resize();
  clear(ctx, canvas);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const keys = ["R","E","T","G","I","B"];
  const left = 92;
  const rightPad = 10;
  const barW = W - left - rightPad;
  const top = 36;
  const rowH = (H-54)/keys.length;

  ctx.fillStyle = COLORS.ink;
  ctx.font = "950 13px ui-sans-serif, system-ui";
  ctx.fillText("Semana â€” Hoje (barra) vs Ideal (linha)", 10, 18);

  keys.forEach((k, idx)=>{
    const y = top + idx*rowH + 10;

    // label
    ctx.fillStyle = COLORS.ink;
    ctx.font = "900 12px ui-sans-serif, system-ui";
    ctx.fillText(`${EMOJI[k]} ${LABEL[k]}`, 10, y+10);

    // back
    ctx.fillStyle = COLORS.soft2;
    roundRect(ctx, left, y, barW, 14, 8, true, false);

    // bar (hoje)
    const bw = Math.round((curW[k]/100)*barW);
    ctx.fillStyle = COLORS[k] || "rgba(15,23,42,.50)";
    roundRect(ctx, left, y, bw, 14, 8, true, false);

    // ideal line
    const ix = left + Math.round((idealW[k]/100)*barW);
    ctx.strokeStyle = "rgba(15,23,42,.55)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(ix, y-4);
    ctx.lineTo(ix, y+18);
    ctx.stroke();

    // numbers
    ctx.fillStyle = "rgba(15,23,42,.70)";
    ctx.font = "800 11px ui-sans-serif, system-ui";
    ctx.textAlign = "right";
    ctx.fillText(`hoje ${curW[k]}% | ideal ${idealW[k]}%`, W-10, y+11);
    ctx.textAlign = "left";
  });
}

function drawGauge(canvasId, value, label, color){
  const canvas = document.getElementById(canvasId);
  const pack = canvasId==="cvBureau" ? C.bureau : C.mental;
  const {ctx, resize} = pack;
  resize();
  clear(ctx, canvas);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const cx = W*0.50, cy = H*0.70;
  const r = Math.min(W*0.38, H*0.55);
  const start = Math.PI*1.02;
  const end = Math.PI*1.98;

  // base arc
  ctx.lineWidth = 16;
  ctx.strokeStyle = COLORS.soft2;
  ctx.beginPath();
  ctx.arc(cx, cy, r, start, end);
  ctx.stroke();

  // segments (verde/amarelo/vermelho)
  const seg = [
    {to: 0.40, c:"rgba(22,163,74,.65)"},
    {to: 0.70, c:"rgba(245,158,11,.70)"},
    {to: 1.00, c:"rgba(239,68,68,.65)"}
  ];
  let prev = 0;
  seg.forEach(s=>{
    const a0 = start + (end-start)*prev;
    const a1 = start + (end-start)*s.to;
    ctx.strokeStyle = s.c;
    ctx.beginPath(); ctx.arc(cx,cy,r,a0,a1); ctx.stroke();
    prev = s.to;
  });

  // value arc
  const pct = Math.max(0, Math.min(100, value))/100;
  ctx.strokeStyle = color;
  ctx.beginPath();
  ctx.arc(cx, cy, r, start, start + (end-start)*pct);
  ctx.stroke();

  // needle
  const ang = start + (end-start)*pct;
  const nx = cx + Math.cos(ang)*(r-6);
  const ny = cy + Math.sin(ang)*(r-6);
  ctx.lineWidth = 2;
  ctx.strokeStyle = "rgba(15,23,42,.75)";
  ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(nx,ny); ctx.stroke();
  ctx.fillStyle = "rgba(15,23,42,.85)";
  ctx.beginPath(); ctx.arc(cx,cy,5,0,Math.PI*2); ctx.fill();

  // texts
  ctx.fillStyle = COLORS.ink;
  ctx.font = "950 13px ui-sans-serif, system-ui";
  ctx.textAlign="center";
  ctx.fillText(label, cx, 18);

  ctx.font = "990 30px ui-sans-serif, system-ui";
  ctx.fillText(`${Math.round(value)}`, cx, cy-18);

  ctx.fillStyle = "rgba(15,23,42,.65)";
  ctx.font = "800 12px ui-sans-serif, system-ui";
  ctx.fillText("/100", cx, cy+2);
}

function drawQuad(impact, energy){
  const canvas = document.getElementById("cvQuad");
  const {ctx, resize} = C.quad;
  resize();
  clear(ctx, canvas);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  const pad = 42;
  const x0 = pad, y0 = pad;
  const x1 = W-pad, y1 = H-pad;

  // axes
  ctx.strokeStyle = COLORS.soft;
  ctx.lineWidth = 1;
  ctx.beginPath(); ctx.moveTo(x0, y1); ctx.lineTo(x1, y1); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(x0, y1); ctx.lineTo(x0, y0); ctx.stroke();

  // mid lines
  const mx = x0 + (x1-x0)/2;
  const my = y0 + (y1-y0)/2;
  ctx.strokeStyle = "rgba(15,23,42,.10)";
  ctx.beginPath(); ctx.moveTo(mx, y0); ctx.lineTo(mx, y1); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(x0, my); ctx.lineTo(x1, my); ctx.stroke();

  // labels
  ctx.fillStyle = COLORS.ink;
  ctx.font = "950 13px ui-sans-serif, system-ui";
  ctx.fillText("Impacto Ã— Energia (onde investir)", 10, 18);

  ctx.fillStyle = "rgba(15,23,42,.65)";
  ctx.font = "800 11px ui-sans-serif, system-ui";
  ctx.fillText("Impacto â†’", x1-70, y1+24);
  ctx.save();
  ctx.translate(x0-28, y0+70);
  ctx.rotate(-Math.PI/2);
  ctx.fillText("Energia (sustentÃ¡vel) â†’", 0, 0);
  ctx.restore();

  const keys=["R","E","T","G","I"];
  keys.forEach(k=>{
    const ix = (impact[k]||0)/100;
    const ey = (energy[k]||0)/100;
    const px = x0 + ix*(x1-x0);
    const py = y1 - ey*(y1-y0);

    ctx.fillStyle = COLORS[k];
    ctx.beginPath(); ctx.arc(px,py,7,0,Math.PI*2); ctx.fill();

    ctx.fillStyle = "rgba(15,23,42,.85)";
    ctx.font = "900 11px ui-sans-serif, system-ui";
    ctx.fillText(`${EMOJI[k]} ${LABEL[k]}`, px+10, py+4);
  });

  // quadrant hints
  ctx.fillStyle = "rgba(15,23,42,.60)";
  ctx.font = "800 10px ui-sans-serif, system-ui";
  ctx.fillText("Alto impacto / alta energia = ouro", mx+6, my-6);
  ctx.fillText("Alto impacto / baixa energia = risco de burnout", mx+6, y1-10);
}

function drawFunnel(curW, B, M){
  const canvas = document.getElementById("cvFunnel");
  const {ctx, resize} = C.funnel;
  resize();
  clear(ctx, canvas);

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  ctx.fillStyle = COLORS.ink;
  ctx.font = "950 13px ui-sans-serif, system-ui";
  ctx.fillText("Drenos (visÃ£o simples da semana)", 10, 18);

  const items = [
    {k:"B", name:"Burocracia", v: curW.B, c: COLORS.B},
    {k:"T", name:"Ensino (operacional)", v: curW.T, c: COLORS.T},
    {k:"G", name:"GestÃ£o (processos)", v: curW.G, c: COLORS.G},
    {k:"R", name:"Pesquisa (profundo)", v: curW.R, c: COLORS.R},
    {k:"E", name:"ExtensÃ£o (campo)", v: curW.E, c: COLORS.E},
    {k:"I", name:"InovaÃ§Ã£o (criaÃ§Ã£o)", v: curW.I, c: COLORS.I}
  ].sort((a,b)=>b.v-a.v);

  const left=16, top=36, rowH=(H-56)/items.length, maxW=W-32;

  items.forEach((it, idx)=>{
    const y = top + idx*rowH + 10;
    // bar back
    ctx.fillStyle = COLORS.soft2;
    roundRect(ctx, left, y, maxW, 14, 8, true, false);

    // bar fill
    ctx.fillStyle = it.c;
    roundRect(ctx, left, y, Math.round((it.v/100)*maxW), 14, 8, true, false);

    // label
    ctx.fillStyle = "rgba(15,23,42,.85)";
    ctx.font = "900 11px ui-sans-serif, system-ui";
    ctx.fillText(`${EMOJI[it.k]} ${it.name}`, left, y-3);

    // value
    ctx.fillStyle = "rgba(15,23,42,.65)";
    ctx.font = "800 11px ui-sans-serif, system-ui";
    ctx.textAlign="right";
    ctx.fillText(`${it.v}%`, W-16, y+11);
    ctx.textAlign="left";
  });

  // small note
  ctx.fillStyle = "rgba(15,23,42,.60)";
  ctx.font = "800 11px ui-sans-serif, system-ui";
  ctx.fillText(`Burocracia=${B}/100 Â· Carga mental=${M}/100`, 16, H-10);
}

/* =========================
   NARRATIVA + PLANO + CHECKLIST
========================= */
function buildNarrative(data){
  const name = (val("name") || "Visitante").trim();
  const uni  = (val("uni") || "sua universidade").trim();
  const dept = (val("dept") || "seu departamento").trim();
  const prog = (val("prog") || "seu programa").trim();
  const hours = clampNum("hours",1,120);

  const core = topRole(data.cur);
  const desired = topRole({R:data.goal.R,E:data.goal.E,T:data.goal.T,G:data.goal.G,I:data.goal.I});
  const rk = riskLabel(data.capture);

  // maior gap
  const biggestGap = Object.keys(data.gap).reduce((a,k)=> Math.abs(data.gap[k]) > Math.abs(data.gap[a]) ? k : a, "R");
  const gapAbs = Math.abs(data.gap[biggestGap]);
  const gapDir = data.gap[biggestGap] >= 0 ? "crescer" : "reduzir";

  const captureTxt =
    data.capture >= 70 ? "Seu sistema estÃ¡ em modo incÃªndio. Se vocÃª nÃ£o redesenhar agenda e processos, sua identidade vira sobrevivÃªncia." :
    data.capture >= 40 ? "VocÃª estÃ¡ no limite do sustentÃ¡vel. Sem corte/automaÃ§Ã£o, o essencial vira opcional." :
    "Sua carga parece administrÃ¡vel, mas o risco Ã© crescer projeto sem criar processo. Previna.";

  const alignment =
    core===desired
      ? "Seu eixo atual conversa com seu desejo. Agora Ã© blindar tempo e transformar em ritual contÃ­nuo."
      : "Seu eixo atual nÃ£o conversa com seu desejo. Isso nÃ£o Ã© defeito: Ã© diagnÃ³stico de custo invisÃ­vel. O que vocÃª estÃ¡ sacrificando para sustentar o presente?";

  const txt = `
    <b>${name}</b> â€” <b>${uni}</b> (${dept}; ${prog}) Â· <b>${phaseTxt()}</b> Â· <b>${hours}h/semana</b><br><br>
    Eixo atual: <b>${EMOJI[core]} ${LABEL[core]}</b> Â· Eixo desejado: <b>${EMOJI[desired]} ${LABEL[desired]}</b><br>
    <b>${alignment}</b><br><br>
    <b>âš« Burocracia:</b> ${data.cur.B}/100 (tolerÃ¢ncia: ${data.goal.tolB}) Â· <b>ğŸ§  Carga mental:</b> ${data.cur.M}/100 (tolerÃ¢ncia: ${data.goal.tolM})<br>
    <b>Risco de captura:</b> <span style="color:${clsColor(rk.cls)}"><b>${rk.txt}</b></span> â€” ${captureTxt}<br><br>
    Maior ajuste: <b>${gapDir}</b> em <b>${EMOJI[biggestGap]} ${LABEL[biggestGap]}</b> (~<b>${gapAbs}</b> pts).<br>
    A saÃ­da nÃ£o Ã© â€œtrabalhar maisâ€. Ã‰ <b>trabalhar com arquitetura</b>: agenda, processos, limites e delegaÃ§Ã£o.
  `;

  return {txt, core, desired, rk, biggestGap};
}

function buildMoves(data, meta){
  const moves=[];
  const core=meta.core, desired=meta.desired, gapKey=meta.biggestGap;

  moves.push({
    ttl:"48 horas â€” parar a hemorragia (sem heroÃ­smo)",
    txt:"1) Corte 1 reuniÃ£o sem decisÃ£o. 2) Crie 1 template para o dreno que mais se repete. 3) Bloqueie 2 sessÃµes de foco (90â€“120 min) no melhor horÃ¡rio."
  });

  moves.push({
    ttl:"7 dias â€” proteger o essencial",
    txt:"Defina seu â€˜horÃ¡rio sagradoâ€™ (foco). Crie pauta padrÃ£o para reuniÃµes. FaÃ§a uma lista do que vocÃª NÃƒO faz. A burocracia precisa de limite formal."
  });

  const ritual = {
    R:"Pipeline semanal: perguntaâ†’dadosâ†’rascunhoâ†’submissÃ£o. Uma micro-entrega/semana.",
    E:"Ritual mensal com parceiros fixos + 3 indicadores simples (nÃ£o sÃ³ fotos).",
    T:"Uma disciplina vira â€˜laboratÃ³rio autoralâ€™: casos, projetos, rubricas e feedback.",
    G:"GestÃ£o com limite: agenda de gestÃ£o, decisÃµes registradas, delegaÃ§Ã£o e encerramento de comissÃµes inÃºteis.",
    I:"InovaÃ§Ã£o com usuÃ¡rio: protÃ³tipoâ†’testeâ†’ajuste. Depois institucionalize (manual + replicaÃ§Ã£o)."
  };
  moves.push({ ttl:"30 dias â€” transformar eixo em ritual", txt: ritual[desired] || "Crie um processo replicÃ¡vel que sobreviva Ã  sua semana." });

  moves.push({
    ttl:"90 dias â€” reequilibrar semana real vs ideal",
    txt:"Compare o grÃ¡fico Semana (Hoje vs Ideal). FaÃ§a 2 mudanÃ§as estruturais: (a) reduzir reuniÃµes, (b) automatizar relatÃ³rio, (c) delegar rotina, (d) fechar uma frente. RefaÃ§a o diagnÃ³stico no dia 90."
  });

  if(data.capture >= 40){
    moves.push({
      ttl:"Plano antiburnout (objetivo, nÃ£o motivacional)",
      txt:"Sono e foco viram polÃ­tica. Tire reuniÃµes do melhor horÃ¡rio cognitivo. Pare de aceitar urgÃªncia como normal. Sem isso, vocÃª perde ciÃªncia, ensino e saÃºde."
    });
  }

  if(core !== desired){
    moves.push({
      ttl:"Ponte identitÃ¡ria (do que vocÃª Ã© ao que quer ser)",
      txt:"Crie 1 projeto-ponte: seu eixo atual deve alimentar o desejado. Ex.: pesquisa â†’ ensino (aula autoral); ensino â†’ pesquisa (dados didÃ¡ticos); extensÃ£o â†’ inovaÃ§Ã£o (ferramentas)."
    });
  }

  const gapAdvice = {
    R:"Crescer pesquisa = proteger escrita e reduzir frentes. Sem pipeline, tudo vira urgÃªncia.",
    E:"Crescer extensÃ£o = menos evento e mais continuidade (parceria + indicadores).",
    T:"Crescer ensino = autoria didÃ¡tica (casos, projetos, rubricas) e inclusÃ£o real.",
    G:"Crescer gestÃ£o = decidir e delegar, nÃ£o â€˜segurar tudoâ€™. GestÃ£o sem limite captura.",
    I:"Crescer inovaÃ§Ã£o = testar com usuÃ¡rios e institucionalizar (senÃ£o morre em vocÃª)."
  };
  moves.push({ ttl:`Onde mexer primeiro: ${EMOJI[gapKey]} ${LABEL[gapKey]}`, txt: gapAdvice[gapKey] });

  return moves;
}

function buildChecklist(data, meta){
  const blocks = [];

  blocks.push({
    title:"ğŸ§¯ 48 horas (anticaos)",
    hint:"AÃ§Ãµes pequenas que mudam o sistema rapidamente.",
    items:[
      "Corte <b>1 reuniÃ£o</b> sem pauta/decisÃ£o (ou reduza pela metade).",
      "Crie <b>1 template</b> (e-mail, relatÃ³rio, orientaÃ§Ã£o, ata) para o dreno mais frequente.",
      "Bloqueie <b>2 sessÃµes</b> de foco profundo (90â€“120 min) no melhor horÃ¡rio da semana.",
      "Escolha <b>1 tarefa</b> repetitiva e transforme em checklist (passo a passo).",
      "Tire as notificaÃ§Ãµes do celular por <b>4 horas</b> no perÃ­odo de foco."
    ]
  });

  blocks.push({
    title:"ğŸ“Œ 7 dias (blindagem)",
    hint:"Sem blindagem, o essencial vira â€œquando derâ€.",
    items:[
      "Defina seu <b>horÃ¡rio sagrado</b> (foco) e trate como aula.",
      "Crie uma regra: reuniÃ£o sÃ³ com <b>pauta + saÃ­da</b> (decisÃ£o registrada).",
      "Liste o que vocÃª <b>nÃ£o faz</b> (limites formais).",
      "Delegue <b>1 rotina</b> (com padrÃ£o de qualidade + acompanhamento).",
      "Reserve 20 min para <b>organizar arquivos</b> do projeto (estrutura simples)."
    ]
  });

  blocks.push({
    title:"ğŸ§­ 30 dias (ritual do eixo)",
    hint:"Ritual Ã© continuidade. Continuidade Ã© poder acadÃªmico.",
    items:[
      `Transforme <b>${LABEL[meta.desired]}</b> em processo: uma entrega semanal pequena.`,
      "Documente seu projeto em 1 pÃ¡gina: <b>objetivo, pÃºblico, rotina, indicadores, entregas</b>.",
      "Defina <b>indicadores</b> (3) que faÃ§am sentido (sem burocracia vazia).",
      "Crie uma rotina de <b>revisÃ£o quinzenal</b> do que entrou e do que sai da agenda.",
      "Publique (para vocÃª mesmo) um <b>diÃ¡rio de decisÃµes</b> (o que aceitou/recusou e por quÃª)."
    ]
  });

  blocks.push({
    title:"ğŸ 90 dias (equilÃ­brio)",
    hint:"Se depois de 90 dias nada mudou, o sistema ganhou.",
    items:[
      "Redesenhe a semana para reduzir <b>Burocracia</b> em pelo menos 10 pontos.",
      "Mova reuniÃµes para horÃ¡rios de <b>baixo desempenho cognitivo</b>.",
      "Feche 1 frente aberta que nÃ£o conversa com sua meta.",
      "Crie uma estratÃ©gia de <b>orientaÃ§Ãµes</b> (grupo, templates, encontros temÃ¡ticos).",
      "RefaÃ§a este diagnÃ³stico e compare os grÃ¡ficos."
    ]
  });

  blocks.push({
    title:"ğŸ¤ InclusÃ£o real (neurodivergÃªncia e acessibilidade)",
    hint:"Isso nÃ£o Ã© â€˜extraâ€™: Ã© qualidade do ensino.",
    items:[
      "Adote uma estrutura de aula previsÃ­vel (agenda, metas, pausas).",
      "OfereÃ§a <b>mÃºltiplas formas</b> de participaÃ§Ã£o (fala, texto, anÃ´nimo, grupo).",
      "Garanta acessibilidade bÃ¡sica: <b>contraste, fontes legÃ­veis, texto alternativo</b>.",
      "Defina regras de convivÃªncia: respeito, tempo de fala, acolhimento.",
      "Crie rubricas claras e dÃª feedback curto (evita sofrimento e injustiÃ§a)."
    ]
  });

  blocks.push({
    title:"ğŸ¤– IA (Ã©tica + pedagogia)",
    hint:"IA sem regra vira ruÃ­do; com regra vira ferramenta.",
    items:[
      "Defina o que pode: IA para rascunho, revisÃ£o, explicaÃ§Ã£o â€” com <b>declaraÃ§Ã£o de uso</b>.",
      "Defina o que nÃ£o pode: gerar respostas finais sem autoria e sem referÃªncia.",
      "Mostre exemplos bons e ruins (transparÃªncia).",
      "Exija citaÃ§Ã£o de fontes reais (nÃ£o sÃ³ texto bonito).",
      "Use IA para reduzir burocracia docente (templates) e liberar tempo de qualidade."
    ]
  });

  blocks.push({
    title:"ğŸ§  SaÃºde mental (sem romantizar)",
    hint:"Professor quebrado nÃ£o sustenta projeto nem gente.",
    items:[
      "Proteja sono como polÃ­tica (sem culpa).",
      "Recuse urgÃªncia como padrÃ£o: crie janelas de resposta a e-mails.",
      "FaÃ§a 1 conversa â€˜de verdadeâ€™ sobre saÃºde mental na turma/equipe.",
      "Tire 1 atividade do calendÃ¡rio (reduÃ§Ã£o consciente).",
      "Tenha um dia/turno sem universidade (se isso Ã© impossÃ­vel, o diagnÃ³stico estÃ¡ certo)."
    ]
  });

  blocks.push({
    title:"âš« Antiburocracia (engenharia)",
    hint:"Burocracia inevitÃ¡vel â‰  burocracia dominante.",
    items:[
      "Crie biblioteca de templates (atas, relatÃ³rios, e-mails, orientaÃ§Ãµes).",
      "Padronize arquivos do projeto (nomeaÃ§Ã£o + pastas).",
      "ReuniÃ£o sem decisÃ£o nÃ£o existe: encerre em 15 minutos.",
      "Se Ã© recorrente, vira processo: checklist + responsÃ¡vel + prazo.",
      "Diga â€œnÃ£oâ€ elegante: â€˜posso em X data / posso se for Y / nÃ£o posso por Zâ€™."
    ]
  });

  return blocks;
}

function renderChecklist(blocks){
  const grid = document.getElementById("checkGrid");
  grid.innerHTML = "";
  blocks.forEach(b=>{
    const card = document.createElement("div");
    card.className = "checkCard";
    card.innerHTML = `<h3>${b.title}</h3><p class="hint">${b.hint}</p>`;
    b.items.forEach(txt=>{
      const row = document.createElement("div");
      row.className = "ck";
      row.innerHTML = `<input type="checkbox"><div class="txt">${txt}</div>`;
      card.appendChild(row);
    });
    grid.appendChild(card);
  });

  document.getElementById("closing").innerHTML = `
    <div style="line-height:1.65; font-size:13px; color:rgba(15,23,42,.92);">
      <b>1)</b> Professor universitÃ¡rio nÃ£o Ã© â€œfunÃ§Ã£oâ€: Ã© um <b>ecossistema de decisÃµes</b> sobre tempo, sentido e compromisso pÃºblico.<br>
      <b>2)</b> Pesquisa sem ensino vira especializaÃ§Ã£o muda; ensino sem pesquisa vira repetiÃ§Ã£o; extensÃ£o sem criticidade vira evento; gestÃ£o sem limite vira captura; inovaÃ§Ã£o sem instituiÃ§Ã£o vira hobby.<br>
      <b>3)</b> A universidade mede o que vocÃª consegue <b>registrar</b> â€” seu trabalho Ã© nÃ£o virar refÃ©m do registro.<br>
      <b>4)</b> O recurso mais raro Ã© <b>atenÃ§Ã£o</b>. A sobrevivÃªncia docente Ã© arquitetura: agenda, processos e limites.<br>
      <b>5)</b> O professor maduro nÃ£o â€œfaz tudoâ€: ele <b>forma pessoas</b> e cria estruturas para o trabalho sobreviver ao seu nome.
    </div>
  `;
}

/* =========================
   TABS
========================= */
document.querySelectorAll(".tab[data-tab]").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab[data-tab]").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    const tab = t.dataset.tab;
    document.getElementById("tab-responder").style.display = (tab==="responder") ? "" : "none";
    document.getElementById("tab-metas").style.display = (tab==="metas") ? "" : "none";
    document.getElementById("tab-perguntas").style.display = (tab==="perguntas") ? "" : "none";
  });
});
document.querySelectorAll(".tab[data-rtab]").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab[data-rtab]").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    const tab = t.dataset.rtab;
    document.getElementById("rtab-resultados").style.display = (tab==="resultados") ? "" : "none";
    document.getElementById("rtab-plano").style.display = (tab==="plano") ? "" : "none";
    document.getElementById("rtab-check").style.display = (tab==="check") ? "" : "none";
  });
});

/* =========================
   RUN + RENDER
========================= */
const statusPill = document.getElementById("statusPill");

function val(id){ return document.getElementById(id).value; }
function setVal(id,v){ document.getElementById(id).value = (v ?? ""); }

function run(){
  const data = compute();
  if(data.missing.length){
    statusPill.textContent = `faltam ${data.missing.length} respostas`;
    statusPill.style.background = "rgba(245,158,11,.12)";
    statusPill.style.borderColor = "rgba(245,158,11,.25)";
    document.getElementById("story").innerHTML =
      `Faltam respostas nas questÃµes: <b>${data.missing.join(", ")}</b>. VÃ¡ na aba <b>Perguntas</b> e complete.`;
    return;
  }

  const meta = buildNarrative(data);
  const moves = buildMoves(data, meta);
  const blocks = buildChecklist(data, meta);

  // KPIs
  document.getElementById("kpiCore").textContent = `${EMOJI[meta.core]} ${LABEL[meta.core]}`;
  const r = riskLabel(data.capture);
  document.getElementById("kpiRisk").textContent = r.txt;
  document.getElementById("kpiRisk").style.color = clsColor(r.cls);

  // Story + quote
  document.getElementById("story").innerHTML = meta.txt;
  document.getElementById("quote").innerHTML = `
    <b>TrÃªs ideias para debate (sem autoajuda):</b><br>
    â€¢ A universidade te puxa para ser <b>operador de processos</b>. VocÃª precisa decidir se aceita essa identidade.<br>
    â€¢ O docente que nÃ£o protege atenÃ§Ã£o vira â€œprodutor de ruÃ­doâ€: responde tudo, mas constrÃ³i pouco.<br>
    â€¢ SaÃºde mental nÃ£o Ã© â€œpessoalâ€: Ã© <b>institucional</b>. Se a instituiÃ§Ã£o te adoece, ela tambÃ©m adoece sua ciÃªncia e seu ensino.
  `;

  // Plan
  const movesEl = document.getElementById("moves");
  movesEl.innerHTML = "";
  moves.forEach(m=>{
    const d = document.createElement("div");
    d.className = "move";
    d.innerHTML = `<p class="ttl">${m.ttl}</p><p class="txt">${m.txt}</p>`;
    movesEl.appendChild(d);
  });

  // Checklist
  renderChecklist(blocks);

  // Draw charts (sem deformar)
  drawRadar(data.cur, {R:data.goal.R,E:data.goal.E,T:data.goal.T,G:data.goal.G,I:data.goal.I});
  drawWeekBars(data.currentWeek, data.ideal);

  const bColor = data.cur.B>=70 ? "rgba(239,68,68,.80)" : (data.cur.B>=40 ? "rgba(245,158,11,.85)" : "rgba(22,163,74,.80)");
  drawGauge("cvBureau", data.cur.B, `Burocracia: ${data.cur.B}/100 (fricÃ§Ã£o +${data.frictionB})`, bColor);

  const mColor = data.cur.M>=70 ? "rgba(239,68,68,.80)" : (data.cur.M>=40 ? "rgba(245,158,11,.85)" : "rgba(22,163,74,.80)");
  drawGauge("cvMental", data.cur.M, `Carga mental: ${data.cur.M}/100 (acima do limite +${data.frictionM})`, mColor);

  drawQuad(data.impact, data.energy);
  drawFunnel(data.currentWeek, data.cur.B, data.cur.M);

  statusPill.textContent = "diagnÃ³stico gerado";
  statusPill.style.background = "rgba(22,163,74,.12)";
  statusPill.style.borderColor = "rgba(22,163,74,.25)";
}

document.getElementById("btnRun").addEventListener("click", run);
document.getElementById("btnRun2").addEventListener("click", run);

// Redesenhar ao redimensionar (mantÃ©m grÃ¡ficos bonitos)
window.addEventListener("resize", ()=>{
  // sÃ³ redesenha se jÃ¡ houver diagnÃ³stico com tudo respondido
  if(countAnswered() === QUESTIONS.length){
    run();
  }else{
    // desenhar placeholders â€œlimposâ€
    drawRadar({R:0,E:0,T:0,G:0,I:0},{R:0,E:0,T:0,G:0,I:0});
    drawWeekBars({R:0,E:0,T:0,G:0,I:0,B:0},{R:0,E:0,T:0,G:0,I:0,B:0});
    drawGauge("cvBureau", 0, "Burocracia: 0/100", "rgba(22,163,74,.80)");
    drawGauge("cvMental", 0, "Carga mental: 0/100", "rgba(22,163,74,.80)");
    drawQuad({R:0,E:0,T:0,G:0,I:0},{R:0,E:0,T:0,G:0,I:0});
    drawFunnel({R:0,E:0,T:0,G:0,I:0,B:0},0,0);
  }
});

/* =========================
   SAVE / LOAD
========================= */
function collectState(){
  const answers = {};
  QUESTIONS.forEach(q=>{ answers[q.id] = document.getElementById(q.id).value || ""; });
  return {
    name: val("name"), uni: val("uni"), dept: val("dept"), prog: val("prog"),
    phase: val("phase"), hours: val("hours"), notes: val("notes"),
    goalR: val("goalR"), goalE: val("goalE"), goalT: val("goalT"),
    goalG: val("goalG"), goalI: val("goalI"), tolB: val("tolB"), tolM: val("tolM"),
    idealR: val("idealR"), idealE: val("idealE"), idealT: val("idealT"),
    idealG: val("idealG"), idealI: val("idealI"), idealB: val("idealB"),
    answers
  };
}
function applyState(s){
  if(!s) return;
  setVal("name", s.name); setVal("uni", s.uni); setVal("dept", s.dept); setVal("prog", s.prog);
  setVal("phase", s.phase || "early"); setVal("hours", s.hours || 45); setVal("notes", s.notes || "");
  setVal("goalR", s.goalR ?? 70); setVal("goalE", s.goalE ?? 75); setVal("goalT", s.goalT ?? 70);
  setVal("goalG", s.goalG ?? 40); setVal("goalI", s.goalI ?? 60);
  setVal("tolB", s.tolB ?? 35); setVal("tolM", s.tolM ?? 45);
  setVal("idealR", s.idealR ?? 25); setVal("idealE", s.idealE ?? 25); setVal("idealT", s.idealT ?? 25);
  setVal("idealG", s.idealG ?? 15); setVal("idealI", s.idealI ?? 10); setVal("idealB", s.idealB ?? 15);

  if(s.answers){
    Object.keys(s.answers).forEach(id=>{
      const el = document.getElementById(id);
      if(el){
        el.value = s.answers[id];
        const vbox = document.getElementById(id+"_v");
        if(vbox) vbox.textContent = el.value ? el.value : "â€”";
      }
    });
  }
  updateProgress();
}

document.getElementById("btnSave").addEventListener("click", ()=>{
  localStorage.setItem("eco_docente_v3", JSON.stringify(collectState()));
  statusPill.textContent = "salvo";
  statusPill.style.background = "rgba(37,99,235,.10)";
  statusPill.style.borderColor = "rgba(37,99,235,.20)";
});
document.getElementById("btnLoad").addEventListener("click", ()=>{
  const raw = localStorage.getItem("eco_docente_v3");
  if(!raw){
    statusPill.textContent = "nada salvo";
    statusPill.style.background = "rgba(245,158,11,.12)";
    statusPill.style.borderColor = "rgba(245,158,11,.25)";
    return;
  }
  applyState(JSON.parse(raw));
  statusPill.textContent = "carregado";
  statusPill.style.background = "rgba(37,99,235,.10)";
  statusPill.style.borderColor = "rgba(37,99,235,.20)";
  if(countAnswered() === QUESTIONS.length) run();
});
document.getElementById("btnReset").addEventListener("click", ()=>{
  localStorage.removeItem("eco_docente_v3");
  location.reload();
});

/* =========================
   EXPORT (painel)
========================= */
document.getElementById("btnExport").addEventListener("click", ()=>{
  if(countAnswered() !== QUESTIONS.length){
    alert("Complete as perguntas antes de exportar.");
    return;
  }
  // exporta um â€œpainelâ€ com 3 imagens principais em uma sÃ³
  const out = document.createElement("canvas");
  out.width = 1600;
  out.height = 1000;
  const ctx = out.getContext("2d");

  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,out.width,out.height);

  ctx.fillStyle="rgba(15,23,42,.95)";
  ctx.font="950 34px ui-sans-serif, system-ui";
  ctx.fillText("Ecossistema Docente â€” Painel (V3)", 32, 52);

  ctx.fillStyle="rgba(15,23,42,.65)";
  ctx.font="800 16px ui-sans-serif, system-ui";
  const name = (val("name")||"Visitante").trim();
  const uni  = (val("uni")||"â€”").trim();
  ctx.fillText(`${name} Â· ${uni} Â· ${new Date().toLocaleDateString()}`, 32, 78);

  // Captura canvases (em CSS pixels) via desenho do prÃ³prio canvas (bitmap jÃ¡ ok)
  const radar = document.getElementById("cvRadar");
  const week  = document.getElementById("cvWeek");
  const bureau= document.getElementById("cvBureau");
  const mental= document.getElementById("cvMental");

  // layout
  ctx.drawImage(radar, 32, 110, 760, 360);
  ctx.drawImage(week,  808, 110, 760, 360);
  ctx.drawImage(bureau, 32, 500, 760, 360);
  ctx.drawImage(mental, 808, 500, 760, 360);

  const link = document.createElement("a");
  link.download = "ecossistema-docente-v3.png";
  link.href = out.toDataURL("image/png");
  link.click();
});

/* =========================
   INIT placeholders
========================= */
drawRadar({R:0,E:0,T:0,G:0,I:0},{R:0,E:0,T:0,G:0,I:0});
drawWeekBars({R:0,E:0,T:0,G:0,I:0,B:0},{R:0,E:0,T:0,G:0,I:0,B:0});
drawGauge("cvBureau", 0, "Burocracia: 0/100", "rgba(22,163,74,.80)");
drawGauge("cvMental", 0, "Carga mental: 0/100", "rgba(22,163,74,.80)");
drawQuad({R:0,E:0,T:0,G:0,I:0},{R:0,E:0,T:0,G:0,I:0});
drawFunnel({R:0,E:0,T:0,G:0,I:0,B:0},0,0);

/* auto-load */
const saved = localStorage.getItem("eco_docente_v3");
if(saved){
  applyState(JSON.parse(saved));
  if(countAnswered() === QUESTIONS.length) run();
}
</script>
</body>
</html>
