<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ecossistema Docente ‚Äî Diagn√≥stico & Jogo</title>
  <style>
    :root{
      --bg0:#0b1220;
      --bg1:#111a2e;
      --card: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --txt:#eaf0ff;
      --muted: rgba(234,240,255,.72);

      --r:#60a5fa; /* pesquisa */
      --e:#34d399; /* extens√£o */
      --t:#fbbf24; /* ensino */
      --g:#a78bfa; /* gest√£o */
      --i:#fb7185; /* inova√ß√£o */
      --b:#94a3b8; /* burocracia */

      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 700px at 15% 20%, #1b2a55 0%, transparent 60%),
                  radial-gradient(900px 600px at 80% 30%, #4c1d95 0%, transparent 55%),
                  linear-gradient(180deg,var(--bg0),var(--bg1));
      color:var(--txt);
    }

    header{
      padding:22px 16px 10px;
      max-width:1200px; margin:0 auto;
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:46px; height:46px; border-radius:14px;
      background:
        conic-gradient(from 180deg, var(--r), var(--e), var(--t), var(--g), var(--i), var(--r));
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
    }
    h1{
      font-size:18px; margin:0;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:2px 0 0; color:var(--muted); font-size:13px; line-height:1.35;
      max-width:680px;
    }
    .top-actions{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    button, .btn{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--txt);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition:.15s transform, .15s background;
      font-weight:650;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.11); }
    button:active{ transform: translateY(0); }
    .btn-primary{
      background: linear-gradient(135deg, rgba(96,165,250,.28), rgba(167,139,250,.28));
      border-color: rgba(255,255,255,.18);
    }
    .btn-danger{
      background: rgba(239,68,68,.12);
      border-color: rgba(239,68,68,.25);
    }

    main{
      max-width:1200px; margin:0 auto; padding:0 16px 40px;
      display:grid; gap:14px;
      grid-template-columns: 1.15fr .85fr;
    }
    @media (max-width: 980px){
      main{ grid-template-columns:1fr; }
    }

    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .card-h{
      padding:14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    .card-h h2{
      margin:0; font-size:14px; letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
    }
    .pill{
      font-size:12px; color:var(--muted);
      padding:6px 10px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .card-b{ padding:14px; }

    .grid2{
      display:grid; gap:10px; grid-template-columns: 1fr 1fr;
    }
    @media (max-width:700px){ .grid2{ grid-template-columns:1fr; } }

    label{
      display:block; font-size:12px; color:var(--muted); margin-bottom:6px;
    }
    input, select, textarea{
      width:100%;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--txt);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }
    textarea{ min-height:84px; resize:vertical; }

    .q{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      margin-bottom:10px;
    }
    .q-title{
      font-weight:750;
      margin:0 0 10px;
      line-height:1.35;
    }
    .opts{
      display:grid; gap:8px;
    }
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      transition:.15s transform, .15s background;
    }
    .opt:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .opt input{ width:auto; margin-top:2px; }
    .opt b{ font-size:12px; opacity:.9; }
    .opt span{ display:block; color:var(--muted); font-size:12px; line-height:1.35; margin-top:2px; }

    .bar{
      height:10px; border-radius:999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
    }
    .bar > i{ display:block; height:100%; width:0%; background: linear-gradient(90deg, rgba(96,165,250,.9), rgba(167,139,250,.9)); }

    .legend{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
      color:var(--muted); font-size:12px;
    }
    .tag{
      display:flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
    }
    .dot{ width:10px; height:10px; border-radius:999px; background: white; }

    .kpis{
      display:grid; grid-template-columns:1fr 1fr; gap:10px;
    }
    .kpi{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .kpi .v{ font-size:22px; font-weight:850; }
    .kpi .l{ font-size:12px; color:var(--muted); margin-top:2px; }

    .story{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      line-height:1.55;
      color: rgba(234,240,255,.92);
      font-size:13px;
    }
    .story b{ color:var(--txt); }

    .micro{
      display:grid; gap:10px; margin-top:10px;
    }
    .move{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .move .ttl{ font-weight:850; margin:0 0 4px; }
    .move .txt{ color:var(--muted); font-size:12px; margin:0; line-height:1.45; }

    canvas{
      width:100%;
      height:360px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      display:block;
    }
    .small{
      font-size:12px; color:var(--muted);
      margin-top:8px;
      line-height:1.35;
    }

    .row-actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top:10px;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Ecossistema Docente ‚Äî um jogo de identidade universit√°ria</h1>
        <p class="subtitle">
          Voc√™ n√£o ‚Äú√©‚Äù um papel ‚Äî voc√™ est√° em um <b>equil√≠brio inst√°vel</b> entre pesquisa, extens√£o, ensino, gest√£o e inova√ß√£o.
          A burocracia n√£o √© voca√ß√£o: √© <b>atrito</b>. Este app te mostra seu mapa hoje, seu mapa desejado e movimentos pr√°ticos.
        </p>
      </div>
    </div>
    <div class="top-actions">
      <button class="btn-primary" id="btnRun">Gerar diagn√≥stico</button>
      <button id="btnSave">Salvar</button>
      <button id="btnLoad">Carregar</button>
      <button id="btnExport">Exportar imagem</button>
      <button class="btn-danger" id="btnReset">Resetar</button>
    </div>
  </header>

  <main>
    <!-- ESQUERDA: FORM + PERGUNTAS -->
    <section class="card">
      <div class="card-h">
        <h2>üßæ Identidade & Contexto</h2>
        <span class="pill">V1 ‚Äî ajust√°vel, transparente</span>
      </div>
      <div class="card-b">
        <div class="grid2">
          <div>
            <label>Nome</label>
            <input id="name" placeholder="Ex.: Ernandes"/>
          </div>
          <div>
            <label>Universidade</label>
            <input id="uni" placeholder="Ex.: UNEMAT"/>
          </div>
          <div>
            <label>Departamento</label>
            <input id="dept" placeholder="Ex.: Ci√™ncias Ambientais"/>
          </div>
          <div>
            <label>Programa(s)</label>
            <input id="prog" placeholder="Ex.: PPGCA, PPGEO..."/>
          </div>
          <div>
            <label>Fase da carreira</label>
            <select id="phase">
              <option value="early">In√≠cio (0‚Äì5 anos)</option>
              <option value="mid">Meio (6‚Äì15 anos)</option>
              <option value="senior">S√™nior (16+ anos)</option>
            </select>
          </div>
          <div>
            <label>Tempo ‚Äúreal‚Äù semanal dispon√≠vel (h)</label>
            <input id="hours" type="number" min="1" max="120" value="45"/>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label>Notas livres (opcional): o que voc√™ sente que te puxa / te prende?</label>
          <textarea id="notes" placeholder="Ex.: reuni√µes, sistemas, cobran√ßa por papers, falta de equipe, vontade de fazer impacto..."></textarea>
        </div>
      </div>

      <div class="card-h">
        <h2>üéØ Quem voc√™ quer ser em 5 anos?</h2>
        <span class="pill">Defina suas metas (0‚Äì100)</span>
      </div>
      <div class="card-b">
        <div class="grid2">
          <div><label>Pesquisa üî¨</label><input id="goalR" type="number" min="0" max="100" value="70"></div>
          <div><label>Extens√£o üå±</label><input id="goalE" type="number" min="0" max="100" value="75"></div>
          <div><label>Ensino üéì</label><input id="goalT" type="number" min="0" max="100" value="70"></div>
          <div><label>Gest√£o üß≠</label><input id="goalG" type="number" min="0" max="100" value="40"></div>
          <div><label>Inova√ß√£o üöÄ</label><input id="goalI" type="number" min="0" max="100" value="60"></div>
          <div><label>Toler√¢ncia √† burocracia (0‚Äì100)</label><input id="tolB" type="number" min="0" max="100" value="45"></div>
        </div>
        <div class="small">
          A ‚Äútoler√¢ncia √† burocracia‚Äù n√£o √© submiss√£o ‚Äî √© quanto voc√™ aceita operar sistemas sem perder alma.
          Quanto menor, mais voc√™ precisa de <b>prote√ß√µes</b> (delegar, automatizar, recusar, simplificar).
        </div>
      </div>

      <div class="card-h">
        <h2>üß† 15 dilemas reais (responda no instinto)</h2>
        <span class="pill"><span id="answered">0</span>/15</span>
      </div>
      <div class="card-b" id="quiz"></div>

      <div class="card-b">
        <div class="bar" title="Progresso">
          <i id="pbar"></i>
        </div>
        <div class="row-actions">
          <button class="btn-primary" id="btnRun2">Gerar diagn√≥stico</button>
          <button id="btnRandom">Preencher aleat√≥rio (teste)</button>
        </div>
        <div class="small">
          Dica: este jogo fica muito mais forte quando voc√™ responde pensando em <b>como voc√™ age sob press√£o</b>, n√£o no que seria ‚Äúideal‚Äù.
        </div>
      </div>
    </section>

    <!-- DIREITA: DIAGRAMAS + RESULTADOS -->
    <aside class="card">
      <div class="card-h">
        <h2>üìç Seu Mapa (Atual vs. Desejado)</h2>
        <span class="pill" id="statusPill">aguardando‚Ä¶</span>
      </div>
      <div class="card-b">
        <canvas id="radar" width="900" height="420"></canvas>
        <div class="legend">
          <span class="tag"><i class="dot" style="background:rgba(255,255,255,.85)"></i> Atual</span>
          <span class="tag"><i class="dot" style="background:rgba(255,255,255,.25)"></i> Desejado</span>
          <span class="tag"><i class="dot" style="background:var(--b)"></i> Burocracia (atrito)</span>
        </div>

        <div style="height:10px"></div>

        <canvas id="mapa" width="900" height="420"></canvas>
        <div class="small">
          O ‚ÄúMapa de Tens√µes‚Äù mostra sua energia indo para 5 dire√ß√µes e a burocracia como dreno.
          O objetivo n√£o √© zerar burocracia ‚Äî √© impedir que ela vire <b>identidade</b>.
        </div>
      </div>

      <div class="card-h">
        <h2>üìä Indicadores & Diagn√≥stico</h2>
        <span class="pill">texto interpretativo</span>
      </div>
      <div class="card-b">
        <div class="kpis">
          <div class="kpi">
            <div class="v" id="kpiCore">‚Äî</div>
            <div class="l">Identidade predominante (hoje)</div>
          </div>
          <div class="kpi">
            <div class="v" id="kpiRisk">‚Äî</div>
            <div class="l">Risco de captura burocr√°tica</div>
          </div>
        </div>

        <div style="height:10px"></div>
        <div class="story" id="story">
          Responda as perguntas e clique em <b>Gerar diagn√≥stico</b>.
        </div>

        <div class="micro" id="moves"></div>
      </div>
    </aside>
  </main>

<script>
/**
 * ECOSSISTEMA DOCENTE ‚Äî V1
 * Vetores:
 * R Pesquisa, E Extens√£o, T Ensino, G Gest√£o, I Inova√ß√£o
 * B Burocracia (atrito)
 *
 * A l√≥gica foi feita para voc√™ ajustar f√°cil: edite QUESTIONS e WEIGHTS.
 */

const V = ["R","E","T","G","I","B"];
const LABEL = {R:"Pesquisa",E:"Extens√£o",T:"Ensino",G:"Gest√£o",I:"Inova√ß√£o",B:"Burocracia"};
const EMOJI = {R:"üî¨",E:"üå±",T:"üéì",G:"üß≠",I:"üöÄ",B:"‚ö´"};

const QUESTIONS = [
  {
    t: "1) Chega um edital grande, com dinheiro, mas desalinhado com seu eixo. O que voc√™ faz?",
    o: [
      {k:"A",txt:"Submeto e ajusto depois (o sistema √© assim).", w:{R:2,G:1,B:2}},
      {k:"B",txt:"Submeto pensando em bolsas/estrutura para alunos, mesmo que o tema mude.", w:{T:2,G:1,B:2}},
      {k:"C",txt:"Recuso. Coer√™ncia de trajet√≥ria > oportunidade.", w:{R:2,I:1,B:0}},
      {k:"D",txt:"Encaminho para colega e me coloco como apoio pontual.", w:{G:1,E:1,B:1}},
      {k:"E",txt:"Transformo o edital em laborat√≥rio de inova√ß√£o (produto/servi√ßo/tecnologia).", w:{I:3,R:1,B:1}}
    ]
  },
  {
    t: "2) Voc√™ est√° exausto e precisa escolher UM foco por 60 dias. O que voc√™ escolhe sem culpa?",
    o: [
      {k:"A",txt:"Escrita cient√≠fica intensa (artigo/projeto).", w:{R:3,B:0}},
      {k:"B",txt:"A√ß√µes com territ√≥rio/comunidade (impacto direto).", w:{E:3,B:0}},
      {k:"C",txt:"Preparar aulas impec√°veis e formar gente.", w:{T:3,B:0}},
      {k:"D",txt:"Arrumar processos, equipe, rotinas e governan√ßa.", w:{G:3,B:1}},
      {k:"E",txt:"Prototipar ferramenta/plataforma e testar com usu√°rios.", w:{I:3,B:0}}
    ]
  },
  {
    t: "3) Quando um estudante te procura, o que voc√™ faz primeiro?",
    o: [
      {k:"A",txt:"Pergunto qual pergunta cient√≠fica real ele quer responder.", w:{R:2,T:1,B:0}},
      {k:"B",txt:"Pergunto qual problema do mundo real ele quer tocar.", w:{E:2,T:1,B:0}},
      {k:"C",txt:"Pergunto quais lacunas de forma√ß√£o ele tem e monto trilha.", w:{T:3,B:0}},
      {k:"D",txt:"Pergunto qual √© o papel dele na equipe e prazos.", w:{G:2,T:1,B:1}},
      {k:"E",txt:"Pergunto que produto/solu√ß√£o ele quer construir e validar.", w:{I:2,T:1,B:0}}
    ]
  },
  {
    t: "4) O que mais te irrita na universidade (mas tamb√©m te revela)?",
    o: [
      {k:"A",txt:"Produ√ß√£o medida por contagem, n√£o por contribui√ß√£o.", w:{R:2,B:1}},
      {k:"B",txt:"Impacto social vira evento, n√£o processo continuado.", w:{E:2,B:1}},
      {k:"C",txt:"Ensino vira obriga√ß√£o, n√£o artesanato intelectual.", w:{T:2,B:1}},
      {k:"D",txt:"Gest√£o √© invis√≠vel at√© dar problema.", w:{G:2,B:1}},
      {k:"E",txt:"Inovar √© tratado como ‚Äòextra‚Äô, n√£o como eixo.", w:{I:2,B:1}}
    ]
  },
  {
    t: "5) Seu calend√°rio real √© mais controlado por‚Ä¶",
    o: [
      {k:"A",txt:"Prazos de submiss√£o/publica√ß√£o.", w:{R:2,B:1}},
      {k:"B",txt:"Agenda de campo, territ√≥rio, encontros.", w:{E:2,B:0}},
      {k:"C",txt:"Semanas de aula, corre√ß√µes, materiais.", w:{T:2,B:1}},
      {k:"D",txt:"Reuni√µes, comiss√µes, pareceres, sistemas.", w:{G:2,B:3}},
      {k:"E",txt:"Entregas de prot√≥tipo, teste, usu√°rio.", w:{I:2,B:1}}
    ]
  },
  {
    t: "6) Voc√™ recebe um pedido administrativo urgente, mas sem sentido. Voc√™‚Ä¶",
    o: [
      {k:"A",txt:"Faz r√°pido e volta ao foco (evita conflito).", w:{G:1,B:3}},
      {k:"B",txt:"Negocia: fa√ßo se isso destravar uma a√ß√£o com impacto.", w:{E:1,G:1,B:2}},
      {k:"C",txt:"Recusa educadamente e oferece alternativa mais simples.", w:{I:1,R:1,B:0}},
      {k:"D",txt:"Cria um template/processo para nunca mais perder tempo nisso.", w:{G:2,I:1,B:1}},
      {k:"E",txt:"Aceita e transforma em ‚Äúcaso pedag√≥gico‚Äù (ensina o sistema).", w:{T:2,G:1,B:2}}
    ]
  },
  {
    t: "7) Seu melhor dia de trabalho √© aquele em que‚Ä¶",
    o: [
      {k:"A",txt:"Voc√™ produz uma ideia que vira artigo forte.", w:{R:3,B:0}},
      {k:"B",txt:"A comunidade leva algo que muda pr√°tica.", w:{E:3,B:0}},
      {k:"C",txt:"A turma sai diferente do que entrou.", w:{T:3,B:0}},
      {k:"D",txt:"Um processo institucional para de travar.", w:{G:3,B:1}},
      {k:"E",txt:"Um prot√≥tipo funciona e algu√©m usa de verdade.", w:{I:3,B:0}}
    ]
  },
  {
    t: "8) Se voc√™ pudesse cortar UMA coisa sem culpa, seria‚Ä¶",
    o: [
      {k:"A",txt:"Reuni√µes sem decis√£o.", w:{R:1,B:3}},
      {k:"B",txt:"Eventos sem continuidade.", w:{E:1,B:2}},
      {k:"C",txt:"Burocracia duplicada de ensino.", w:{T:1,B:3}},
      {k:"D",txt:"Presta√ß√£o de contas manual e repetitiva.", w:{G:1,B:3,I:1}},
      {k:"E",txt:"Exig√™ncia de formalismo que mata inova√ß√£o.", w:{I:2,B:2}}
    ]
  },
  {
    t: "9) Voc√™ tem que escolher: reconhecimento interno ou impacto externo?",
    o: [
      {k:"A",txt:"Reconhecimento interno (progress√£o, edital, prest√≠gio).", w:{R:2,G:1,B:1}},
      {k:"B",txt:"Impacto externo (territ√≥rio, pol√≠ticas, transforma√ß√£o social).", w:{E:3,B:0}},
      {k:"C",txt:"Impacto formativo (egressos, doc√™ncia, legado humano).", w:{T:3,B:0}},
      {k:"D",txt:"Estruturar a casa (gest√£o forte hoje para liberdade amanh√£).", w:{G:3,B:1}},
      {k:"E",txt:"Produto escal√°vel (algo que sobreviva al√©m de voc√™).", w:{I:3,B:0}}
    ]
  },
  {
    t: "10) Onde voc√™ mais se perde hoje?",
    o: [
      {k:"A",txt:"Em ‚Äòfazer tudo‚Äô e n√£o escrever.", w:{R:2,B:1}},
      {k:"B",txt:"Em demandas comunit√°rias maiores que a equipe.", w:{E:2,B:1}},
      {k:"C",txt:"Em corrigir demais e criar de menos.", w:{T:2,B:1}},
      {k:"D",txt:"Em sistema, formul√°rio, parecer, reuni√£o.", w:{G:1,B:4}},
      {k:"E",txt:"Em prototipar sem institucionalizar.", w:{I:2,B:1}}
    ]
  },
  {
    t: "11) O que voc√™ faz quando algo d√° errado (projeto atrasou, recurso travou)?",
    o: [
      {k:"A",txt:"Volto ao m√©todo e reorganizo hip√≥teses/dados.", w:{R:2,G:1,B:1}},
      {k:"B",txt:"Refor√ßo alian√ßas e adapto com o territ√≥rio.", w:{E:2,G:1,B:0}},
      {k:"C",txt:"Transformo o erro em aprendizagem para turma/equipe.", w:{T:2,G:1,B:0}},
      {k:"D",txt:"Ataco o gargalo do processo e documento tudo.", w:{G:2,B:2}},
      {k:"E",txt:"Crio workaround tecnol√≥gico/automa√ß√£o/prot√≥tipo.", w:{I:2,G:1,B:1}}
    ]
  },
  {
    t: "12) Voc√™ acredita mais em‚Ä¶",
    o: [
      {k:"A",txt:"Conhecimento que resiste a revis√µes e cr√≠tica.", w:{R:3,B:0}},
      {k:"B",txt:"Conhecimento que muda vida aqui e agora.", w:{E:3,B:0}},
      {k:"C",txt:"Conhecimento que forma pensamento e linguagem.", w:{T:3,B:0}},
      {k:"D",txt:"Conhecimento que vira estrutura para muitos.", w:{G:2,T:1,B:1}},
      {k:"E",txt:"Conhecimento que vira ferramenta replic√°vel.", w:{I:3,B:0}}
    ]
  },
  {
    t: "13) Se algu√©m te chama para uma palestra, voc√™ topa quando‚Ä¶",
    o: [
      {k:"A",txt:"Isso pode virar paper/projeto e consolidar eixo.", w:{R:2,T:1,B:0}},
      {k:"B",txt:"√â com comunidade e tem continuidade real.", w:{E:2,T:1,B:0}},
      {k:"C",txt:"√â aula/palestra que te d√° prazer intelectual.", w:{T:3,B:0}},
      {k:"D",txt:"√â estrat√©gica para parcerias e governan√ßa.", w:{G:2,T:1,B:1}},
      {k:"E",txt:"√â vitrine de uma solu√ß√£o/ferramenta.", w:{I:2,T:1,B:0}}
    ]
  },
  {
    t: "14) Seu medo oculto (profissional) √© mais parecido com‚Ä¶",
    o: [
      {k:"A",txt:"Virar ‚Äòprodutor de paper‚Äô sem sentido.", w:{R:1,B:1}},
      {k:"B",txt:"Virar ‚Äòanimador de evento‚Äô sem transforma√ß√£o.", w:{E:1,B:1}},
      {k:"C",txt:"Virar ‚Äòrepetidor de conte√∫do‚Äô sem autoria.", w:{T:1,B:1}},
      {k:"D",txt:"Virar ‚Äòoperador de sistema‚Äô (burocrata de luxo).", w:{G:1,B:4}},
      {k:"E",txt:"Virar ‚Äòinovador solit√°rio‚Äô sem ades√£o institucional.", w:{I:2,B:1}}
    ]
  },
  {
    t: "15) Se voc√™ tivesse que deixar uma frase como legado, seria‚Ä¶",
    o: [
      {k:"A",txt:"‚ÄúEu aumentei a qualidade do que sabemos.‚Äù", w:{R:3,B:0}},
      {k:"B",txt:"‚ÄúEu conectei universidade e sociedade de verdade.‚Äù", w:{E:3,B:0}},
      {k:"C",txt:"‚ÄúEu formei pessoas livres e competentes.‚Äù", w:{T:3,B:0}},
      {k:"D",txt:"‚ÄúEu deixei a casa funcionando para muitos.‚Äù", w:{G:3,B:1}},
      {k:"E",txt:"‚ÄúEu criei solu√ß√µes que sobreviveram ao meu nome.‚Äù", w:{I:3,B:0}}
    ]
  }
];

// ------------------ UI BUILD ------------------
const quizEl = document.getElementById("quiz");
const answeredEl = document.getElementById("answered");
const pbar = document.getElementById("pbar");

function buildQuiz(){
  quizEl.innerHTML = "";
  QUESTIONS.forEach((q, idx) => {
    const wrap = document.createElement("div");
    wrap.className = "q";
    wrap.dataset.q = idx;

    const title = document.createElement("p");
    title.className = "q-title";
    title.textContent = q.t;

    const opts = document.createElement("div");
    opts.className = "opts";

    q.o.forEach((opt, j) => {
      const id = `q${idx}_${j}`;
      const label = document.createElement("label");
      label.className = "opt";
      label.setAttribute("for", id);

      const radio = document.createElement("input");
      radio.type = "radio";
      radio.name = `q${idx}`;
      radio.id = id;
      radio.value = j;

      radio.addEventListener("change", updateProgress);

      const textBox = document.createElement("div");
      const top = document.createElement("div");
      top.innerHTML = `<b>${opt.k}</b> ‚Äî ${opt.txt}`;
      const weights = document.createElement("span");
      weights.textContent = `Efeito: ${formatWeights(opt.w)}`;
      textBox.appendChild(top);
      textBox.appendChild(weights);

      label.appendChild(radio);
      label.appendChild(textBox);
      opts.appendChild(label);
    });

    wrap.appendChild(title);
    wrap.appendChild(opts);
    quizEl.appendChild(wrap);
  });
}

function formatWeights(w){
  // exibe pesos sem virar ‚Äúdica f√°cil‚Äù
  const order = ["R","E","T","G","I","B"];
  const parts = [];
  order.forEach(k=>{
    if(w[k]) parts.push(`${EMOJI[k]}+${w[k]}`);
  });
  return parts.join("  ");
}

function countAnswered(){
  let n = 0;
  QUESTIONS.forEach((_, i)=>{
    const picked = document.querySelector(`input[name="q${i}"]:checked`);
    if(picked) n++;
  });
  return n;
}

function updateProgress(){
  const n = countAnswered();
  answeredEl.textContent = n;
  const pct = Math.round((n / QUESTIONS.length) * 100);
  pbar.style.width = pct + "%";
}

// ------------------ SCORING ------------------
function compute(){
  const raw = {R:0,E:0,T:0,G:0,I:0,B:0};
  const missing = [];

  QUESTIONS.forEach((q, i)=>{
    const picked = document.querySelector(`input[name="q${i}"]:checked`);
    if(!picked){ missing.push(i+1); return; }
    const opt = q.o[Number(picked.value)];
    Object.keys(opt.w).forEach(k => raw[k] += opt.w[k]);
  });

  // normaliza√ß√£o 0..100 para R,E,T,G,I baseado no m√°ximo poss√≠vel aproximado
  // (como pesos variam pouco, normalizar por soma total ajuda e evita ‚Äúsuperpontos‚Äù)
  const mainSum = raw.R + raw.E + raw.T + raw.G + raw.I;
  const base = Math.max(1, mainSum);

  const cur = {
    R: Math.round((raw.R / base) * 100),
    E: Math.round((raw.E / base) * 100),
    T: Math.round((raw.T / base) * 100),
    G: Math.round((raw.G / base) * 100),
    I: Math.round((raw.I / base) * 100),
    B: Math.min(100, Math.round((raw.B / (QUESTIONS.length*4)) * 100)) // 0..~100
  };

  // metas desejadas
  const goal = {
    R: clampNum("goalR"),
    E: clampNum("goalE"),
    T: clampNum("goalT"),
    G: clampNum("goalG"),
    I: clampNum("goalI"),
    B: clampNum("tolB")
  };

  // atrito: burocracia alta reduz ‚Äúpotencial entregue‚Äù
  // quanto menor toler√¢ncia, maior a dor percebida.
  const tol = goal.B;
  const friction = Math.round((cur.B * (100 - tol)) / 100); // 0..100
  // energia l√≠quida: reduz um pouco os vetores quando friction √© alto (somente para diagn√≥stico narrativo)
  const net = {
    R: Math.max(0, cur.R - Math.round(friction*0.18)),
    E: Math.max(0, cur.E - Math.round(friction*0.18)),
    T: Math.max(0, cur.T - Math.round(friction*0.18)),
    G: Math.max(0, cur.G - Math.round(friction*0.18)),
    I: Math.max(0, cur.I - Math.round(friction*0.18)),
    B: cur.B
  };

  return {raw, cur, goal, net, friction, missing};
}

function clampNum(id){
  const el = document.getElementById(id);
  let v = Number(el.value);
  if(!Number.isFinite(v)) v = 0;
  v = Math.max(0, Math.min(100, Math.round(v)));
  el.value = v;
  return v;
}

function topRole(vec){
  const keys = ["R","E","T","G","I"];
  let best = keys[0];
  keys.forEach(k=>{ if(vec[k] > vec[best]) best = k; });
  return best;
}

function riskLabel(friction, B){
  // captura burocr√°tica: quando B alto e friction alto
  const score = Math.round((B*0.55) + (friction*0.45));
  if(score >= 70) return {txt:"ALTO üî•", cls:"bad"};
  if(score >= 40) return {txt:"M√âDIO ‚ö†Ô∏è", cls:"warn"};
  return {txt:"BAIXO ‚úÖ", cls:"ok"};
}

function clsColor(cls){
  if(cls==="bad") return "var(--bad)";
  if(cls==="warn") return "var(--warn)";
  return "var(--ok)";
}

// ------------------ DIAGNOSTIC TEXT ------------------
function buildStory(data){
  const name = (document.getElementById("name").value || "Visitante").trim();
  const uni = (document.getElementById("uni").value || "sua universidade").trim();
  const dept = (document.getElementById("dept").value || "seu departamento").trim();
  const prog = (document.getElementById("prog").value || "seu programa").trim();
  const hours = clampNum("hours");

  const core = topRole(data.cur);
  const desired = topRole(data.goal);
  const risk = riskLabel(data.friction, data.cur.B);

  const gap = {
    R: data.goal.R - data.cur.R,
    E: data.goal.E - data.cur.E,
    T: data.goal.T - data.cur.T,
    G: data.goal.G - data.cur.G,
    I: data.goal.I - data.cur.I
  };

  const biggestGap = Object.keys(gap).reduce((a,k)=> Math.abs(gap[k]) > Math.abs(gap[a]) ? k : a, "R");
  const gapDir = gap[biggestGap] >= 0 ? "crescer" : "reduzir";
  const gapAbs = Math.abs(gap[biggestGap]);

  // leitura ‚Äúsem moralismo‚Äù
  const phase = document.getElementById("phase").value;
  const phaseTxt = phase==="early" ? "in√≠cio de carreira" : (phase==="mid" ? "meio de carreira" : "fase s√™nior");

  const bureaucracyNote =
    data.cur.B >= 65 ? "A burocracia est√° alta e aparece como for√ßa dominante do seu cen√°rio ‚Äî isso √© perigoso porque ela pode virar identidade sem voc√™ perceber." :
    data.cur.B >= 35 ? "A burocracia est√° presente como atrito relevante ‚Äî n√£o √© sobre ‚Äòaguentar‚Äô, √© sobre criar prote√ß√µes e automa√ß√µes." :
    "A burocracia parece relativamente controlada ‚Äî o risco aqui √© subestimar o atrito quando projetos crescerem.";

  const alignment =
    core === desired ? "Boa not√≠cia: seu ‚Äòcentro‚Äô atual conversa com seu desejo de 5 anos. O trabalho agora √© proteger o foco e impedir vazamentos." :
    "Seu perfil atual e seu desejo de 5 anos n√£o est√£o alinhados ‚Äî isso n√£o √© falha, √© dado. O jogo est√° te mostrando onde voc√™ est√° pagando custo invis√≠vel.";

  const story = `
  <b>${name}</b>, em <b>${uni}</b> (${dept}; ${prog}), fase: <b>${phaseTxt}</b>, com <b>${hours}h/semana</b> ‚Äúreais‚Äù.<br/><br/>
  Hoje, seu vetor predominante √© <b>${EMOJI[core]} ${LABEL[core]}</b>. Seu desejo de 5 anos aponta para <b>${EMOJI[desired]} ${LABEL[desired]}</b>.<br/>
  <b>${alignment}</b><br/><br/>
  <b>Burocracia (atrito):</b> ${data.cur.B}/100. <b>Fric√ß√£o percebida</b> (burocracia √ó baixa toler√¢ncia): <b>${data.friction}/100</b>.<br/>
  ${bureaucracyNote}<br/><br/>
  O maior ponto de ajuste √© <b>${gapDir}</b> em <b>${EMOJI[biggestGap]} ${LABEL[biggestGap]}</b> (gap de <b>${gapAbs}</b> pontos).
  O objetivo n√£o √© virar ‚Äúum novo eu‚Äù ‚Äî √© redesenhar <b>agenda, compromissos e sistemas</b> para que sua identidade real tenha espa√ßo.
  `;

  return {story, core, desired, risk, biggestGap, gap};
}

function buildMoves(data, meta){
  // micro-movimentos: 3 a√ß√µes ‚Äúantiburocracia‚Äù + 1 a√ß√£o para gap
  const moves = [];
  const B = data.cur.B;
  const friction = data.friction;
  const core = meta.core;
  const desired = meta.desired;

  // Movimento 1: prote√ß√£o de agenda
  moves.push({
    ttl:"1) Prote√ß√£o de agenda (blindagem de 2 blocos)",
    txt:"Crie dois blocos fixos por semana (90‚Äì120 min) inegoci√°veis para seu eixo principal. N√£o √© ‚Äòtempo livre‚Äô: √© o motor. Se algu√©m pedir reuni√£o, ofere√ßa outra janela."
  });

  // Movimento 2: anti-atrito (burocracia)
  if(B >= 50 || friction >= 50){
    moves.push({
      ttl:"2) Antiburocracia pr√°tica (automatizar ou delegar 1 dor)",
      txt:"Escolha UM processo repetitivo (relat√≥rio, planilha, chamada, formul√°rio) e transforme em template/automa√ß√£o. Se n√£o der, delegue com padr√£o e checklist. A regra: nunca fazer manualmente duas vezes."
    });
  } else {
    moves.push({
      ttl:"2) Guardi√£o do atrito (preven√ß√£o)",
      txt:"Documente seus processos antes que cres√ßam: templates, checklist e um ‚Äòmanual do projeto‚Äô. Burocracia controlada hoje vira caos amanh√£ se voc√™ escalar sem padr√£o."
    });
  }

  // Movimento 3: recusa estrat√©gica
  moves.push({
    ttl:"3) Recusa estrat√©gica (sim para o eixo, n√£o para o ru√≠do)",
    txt:"Antes de aceitar algo, aplique a pergunta: ‚Äòisso alimenta qual vetor e por qu√™?‚Äô. Se alimentar s√≥ Burocracia, proponha formato m√≠nimo ou recuse com gentileza e alternativa."
  });

  // Movimento 4: gap
  const k = meta.biggestGap;
  const dir = meta.gap[k] >= 0 ? "aumentar" : "reduzir";
  const gapAbs = Math.abs(meta.gap[k]);

  const gapText = {
    R: "Se quer mais pesquisa: proteja escrita, crie pipeline (id√©ia‚Üídados‚Üírascunho‚Üísubmiss√£o) e mate o mito de que ‚Äòum dia eu sento e escrevo‚Äô.",
    E: "Se quer mais extens√£o: transforme a√ß√£o em programa cont√≠nuo (ritual mensal, parceiros fixos, indicadores simples) e evite virar ‚Äòevento sem legado‚Äô.",
    T: "Se quer mais ensino: projete experi√™ncias (n√£o s√≥ conte√∫do), crie material reaproveit√°vel e use a sala como laborat√≥rio do seu eixo.",
    G: "Se quer mais gest√£o: aceite que governan√ßa √© liberdade futura ‚Äî mas imponha limites claros para n√£o virar operador do sistema.",
    I: "Se quer mais inova√ß√£o: defina usu√°rio, problema e prot√≥tipo; depois institucionalize (manual, replica√ß√£o, ado√ß√£o). Inova√ß√£o sem ades√£o vira esfor√ßo solo."
  }[k];

  moves.push({
    ttl:`4) Ajuste do seu destino (${dir} ${LABEL[k]} em ~${gapAbs} pts)`,
    txt: gapText
  });

  // B√¥nus: se core != desired, adicionar ‚Äúponte‚Äù
  if(core !== desired){
    moves.push({
      ttl:"B√îNUS) Construir ponte entre quem voc√™ √© e quem voc√™ quer ser",
      txt:"Escolha um projeto-ponte: algo que use seu vetor atual como motor para aproximar o vetor desejado (ex.: pesquisa que vira extens√£o; extens√£o que vira inova√ß√£o; ensino que vira pesquisa)."
    });
  }

  return moves;
}

// ------------------ DRAWING ------------------
const radar = document.getElementById("radar");
const mapa = document.getElementById("mapa");
const rctx = radar.getContext("2d");
const mctx = mapa.getContext("2d");

function clear(ctx, c){
  ctx.clearRect(0,0,c.width,c.height);
}

function drawRadar(cur, goal, B){
  clear(rctx, radar);

  const W = radar.width, H = radar.height;
  const cx = W*0.36, cy = H*0.52;
  const radius = Math.min(W*0.28, H*0.38);

  const axes = ["R","E","T","G","I"];
  const n = axes.length;

  // background rings
  rctx.save();
  rctx.translate(cx, cy);

  rctx.strokeStyle = "rgba(255,255,255,.12)";
  rctx.lineWidth = 1;
  for(let r=1; r<=5; r++){
    rctx.beginPath();
    const rr = radius*(r/5);
    for(let i=0;i<n;i++){
      const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
      const x = Math.cos(ang)*rr;
      const y = Math.sin(ang)*rr;
      if(i===0) rctx.moveTo(x,y); else rctx.lineTo(x,y);
    }
    rctx.closePath();
    rctx.stroke();
  }

  // axes lines + labels
  axes.forEach((k, i)=>{
    const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
    const x = Math.cos(ang)*radius;
    const y = Math.sin(ang)*radius;

    rctx.beginPath();
    rctx.moveTo(0,0);
    rctx.lineTo(x,y);
    rctx.strokeStyle = "rgba(255,255,255,.14)";
    rctx.stroke();

    rctx.fillStyle = "rgba(234,240,255,.9)";
    rctx.font = "700 14px ui-sans-serif, system-ui";
    const lx = Math.cos(ang)*(radius+22);
    const ly = Math.sin(ang)*(radius+22);
    rctx.fillText(`${EMOJI[k]} ${LABEL[k]}`, lx-30, ly+5);
  });

  // polygon draw helper
  function poly(vec, stroke, fill, alpha){
    rctx.beginPath();
    axes.forEach((k,i)=>{
      const ang = (-Math.PI/2) + (i*(2*Math.PI/n));
      const val = vec[k]/100;
      const x = Math.cos(ang)*radius*val;
      const y = Math.sin(ang)*radius*val;
      if(i===0) rctx.moveTo(x,y); else rctx.lineTo(x,y);
    });
    rctx.closePath();
    rctx.strokeStyle = stroke;
    rctx.lineWidth = 2;
    rctx.stroke();
    rctx.fillStyle = fill;
    rctx.globalAlpha = alpha;
    rctx.fill();
    rctx.globalAlpha = 1;
  }

  // desired (lighter)
  poly(goal, "rgba(255,255,255,.25)", "rgba(255,255,255,.10)", 1);

  // current (strong)
  poly(cur, "rgba(255,255,255,.85)", "rgba(255,255,255,.16)", 1);

  // bureaucracy indicator bar
  rctx.restore();
  const bx = W*0.70, by = H*0.22, bw = W*0.26, bh = 18;
  rctx.fillStyle = "rgba(255,255,255,.08)";
  rctx.strokeStyle = "rgba(255,255,255,.14)";
  rctx.lineWidth = 1;
  roundRect(rctx, bx, by, bw, bh, 10, true, true);

  const fillW = (B/100)*bw;
  rctx.fillStyle = "rgba(148,163,184,.75)";
  roundRect(rctx, bx, by, fillW, bh, 10, true, false);

  rctx.fillStyle = "rgba(234,240,255,.92)";
  rctx.font = "800 13px ui-sans-serif, system-ui";
  rctx.fillText(`‚ö´ Burocracia: ${B}/100`, bx, by-8);
}

function drawMap(cur, goal, B, friction){
  clear(mctx, mapa);
  const W = mapa.width, H = mapa.height;

  const center = {x: W*0.46, y: H*0.55};
  const nodes = {
    R: {x: W*0.18, y: H*0.22},
    E: {x: W*0.12, y: H*0.78},
    T: {x: W*0.46, y: H*0.10},
    G: {x: W*0.78, y: H*0.25},
    I: {x: W*0.84, y: H*0.78},
    B: {x: W*0.92, y: H*0.52} // dreno
  };

  // arrows thickness based on current
  function arrow(a,b,w, color){
    mctx.strokeStyle = color;
    mctx.lineWidth = w;
    mctx.beginPath();
    mctx.moveTo(a.x,a.y);
    mctx.lineTo(b.x,b.y);
    mctx.stroke();

    // head
    const ang = Math.atan2(b.y-a.y, b.x-a.x);
    const size = 10 + w;
    mctx.fillStyle = color;
    mctx.beginPath();
    mctx.moveTo(b.x, b.y);
    mctx.lineTo(b.x - Math.cos(ang-0.35)*size, b.y - Math.sin(ang-0.35)*size);
    mctx.lineTo(b.x - Math.cos(ang+0.35)*size, b.y - Math.sin(ang+0.35)*size);
    mctx.closePath();
    mctx.fill();
  }

  function node(p, title, sub, color, big=false){
    const r = big ? 36 : 28;
    mctx.fillStyle = "rgba(0,0,0,.18)";
    mctx.strokeStyle = "rgba(255,255,255,.14)";
    mctx.lineWidth = 1;
    circle(mctx, p.x, p.y, r, true, true);

    // inner
    mctx.fillStyle = color;
    circle(mctx, p.x, p.y, r-10, true, false);

    mctx.fillStyle = "rgba(234,240,255,.95)";
    mctx.font = "900 14px ui-sans-serif, system-ui";
    mctx.textAlign = "center";
    mctx.fillText(title, p.x, p.y+5);

    if(sub){
      mctx.fillStyle = "rgba(234,240,255,.75)";
      mctx.font = "700 12px ui-sans-serif, system-ui";
      mctx.fillText(sub, p.x, p.y+24);
    }
  }

  // center: You
  node(center, "VOC√ä", "", "rgba(255,255,255,.28)", true);

  // role nodes
  node(nodes.R, "üî¨", `${cur.R}/${goal.R}`, "rgba(96,165,250,.75)");
  node(nodes.E, "üå±", `${cur.E}/${goal.E}`, "rgba(52,211,153,.75)");
  node(nodes.T, "üéì", `${cur.T}/${goal.T}`, "rgba(251,191,36,.75)");
  node(nodes.G, "üß≠", `${cur.G}/${goal.G}`, "rgba(167,139,250,.75)");
  node(nodes.I, "üöÄ", `${cur.I}/${goal.I}`, "rgba(251,113,133,.75)");

  // bureaucracy drain node
  node(nodes.B, "‚ö´", `${B} | fric ${friction}`, "rgba(148,163,184,.70)");

  // arrows from you to roles (thickness by cur)
  arrow(center, nodes.R, 1 + cur.R/18, "rgba(96,165,250,.70)");
  arrow(center, nodes.E, 1 + cur.E/18, "rgba(52,211,153,.70)");
  arrow(center, nodes.T, 1 + cur.T/18, "rgba(251,191,36,.70)");
  arrow(center, nodes.G, 1 + cur.G/18, "rgba(167,139,250,.70)");
  arrow(center, nodes.I, 1 + cur.I/18, "rgba(251,113,133,.70)");

  // drain arrow (burocracy pulls)
  arrow(center, nodes.B, 2 + (B/12), "rgba(148,163,184,.75)");

  // caption
  mctx.fillStyle = "rgba(234,240,255,.92)";
  mctx.font = "900 14px ui-sans-serif, system-ui";
  mctx.textAlign = "left";
  mctx.fillText("Mapa de Tens√µes ‚Äî energia (atual/desejado) + dreno burocr√°tico", 14, 22);

  mctx.fillStyle = "rgba(234,240,255,.72)";
  mctx.font = "700 12px ui-sans-serif, system-ui";
  mctx.fillText("Setas mais grossas = mais energia atual. O dreno mostra quanto o sistema te puxa para operar processos.", 14, 42);
}

function circle(ctx,x,y,r,fill,stroke){
  ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2);
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

function roundRect(ctx, x, y, w, h, r, fill, stroke){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

// ------------------ RUN ------------------
const storyEl = document.getElementById("story");
const movesEl = document.getElementById("moves");
const kpiCore = document.getElementById("kpiCore");
const kpiRisk = document.getElementById("kpiRisk");
const statusPill = document.getElementById("statusPill");

function run(){
  const data = compute();
  if(data.missing.length){
    statusPill.textContent = `faltam ${data.missing.length} respostas`;
    statusPill.style.borderColor = "rgba(245,158,11,.35)";
    statusPill.style.background = "rgba(245,158,11,.12)";
    storyEl.innerHTML = `Faltam respostas nas quest√µes: <b>${data.missing.join(", ")}</b>. Preencha e gere o diagn√≥stico.`;
    return;
  }

  const meta = buildStory(data);
  const moves = buildMoves(data, meta);

  // KPIs
  kpiCore.textContent = `${EMOJI[meta.core]} ${LABEL[meta.core]}`;
  const rk = riskLabel(data.friction, data.cur.B);
  kpiRisk.textContent = rk.txt;
  kpiRisk.style.color = clsColor(rk.cls);

  statusPill.textContent = "diagn√≥stico gerado";
  statusPill.style.borderColor = "rgba(34,197,94,.35)";
  statusPill.style.background = "rgba(34,197,94,.12)";

  // narrative
  storyEl.innerHTML = meta.story;

  // moves
  movesEl.innerHTML = "";
  moves.forEach(m=>{
    const d = document.createElement("div");
    d.className = "move";
    d.innerHTML = `<p class="ttl">${m.ttl}</p><p class="txt">${m.txt}</p>`;
    movesEl.appendChild(d);
  });

  // draw
  drawRadar(data.cur, data.goal, data.cur.B);
  drawMap(data.cur, data.goal, data.cur.B, data.friction);

  // subtle feedback
  updateProgress();
}

document.getElementById("btnRun").addEventListener("click", run);
document.getElementById("btnRun2").addEventListener("click", run);

// ------------------ SAVE/LOAD ------------------
function collectState(){
  const state = {
    name: val("name"),
    uni: val("uni"),
    dept: val("dept"),
    prog: val("prog"),
    phase: val("phase"),
    hours: val("hours"),
    notes: val("notes"),
    goalR: val("goalR"),
    goalE: val("goalE"),
    goalT: val("goalT"),
    goalG: val("goalG"),
    goalI: val("goalI"),
    tolB: val("tolB"),
    answers: QUESTIONS.map((_,i)=>{
      const picked = document.querySelector(`input[name="q${i}"]:checked`);
      return picked ? Number(picked.value) : null;
    })
  };
  return state;
}

function applyState(s){
  if(!s) return;
  setVal("name", s.name);
  setVal("uni", s.uni);
  setVal("dept", s.dept);
  setVal("prog", s.prog);
  setVal("phase", s.phase || "early");
  setVal("hours", s.hours || 45);
  setVal("notes", s.notes || "");

  setVal("goalR", s.goalR ?? 70);
  setVal("goalE", s.goalE ?? 75);
  setVal("goalT", s.goalT ?? 70);
  setVal("goalG", s.goalG ?? 40);
  setVal("goalI", s.goalI ?? 60);
  setVal("tolB", s.tolB ?? 45);

  (s.answers || []).forEach((ans,i)=>{
    if(ans === null || ans === undefined) return;
    const el = document.getElementById(`q${i}_${ans}`);
    if(el){ el.checked = true; }
  });

  updateProgress();
}

function val(id){ return document.getElementById(id).value; }
function setVal(id,v){ document.getElementById(id).value = (v ?? ""); }

document.getElementById("btnSave").addEventListener("click", ()=>{
  const state = collectState();
  localStorage.setItem("eco_docente_v1", JSON.stringify(state));
  statusPill.textContent = "salvo no navegador";
  statusPill.style.borderColor = "rgba(96,165,250,.35)";
  statusPill.style.background = "rgba(96,165,250,.12)";
});

document.getElementById("btnLoad").addEventListener("click", ()=>{
  const raw = localStorage.getItem("eco_docente_v1");
  if(!raw){
    statusPill.textContent = "nada salvo ainda";
    statusPill.style.borderColor = "rgba(245,158,11,.35)";
    statusPill.style.background = "rgba(245,158,11,.12)";
    return;
  }
  applyState(JSON.parse(raw));
  statusPill.textContent = "carregado";
  statusPill.style.borderColor = "rgba(96,165,250,.35)";
  statusPill.style.background = "rgba(96,165,250,.12)";
});

document.getElementById("btnReset").addEventListener("click", ()=>{
  localStorage.removeItem("eco_docente_v1");
  location.reload();
});

// ------------------ EXPORT IMAGE ------------------
document.getElementById("btnExport").addEventListener("click", ()=>{
  // Exporta um PNG composto (radar + mapa) em um √∫nico canvas
  const out = document.createElement("canvas");
  const pad = 18;
  out.width = 1100;
  out.height = 820;
  const ctx = out.getContext("2d");

  // background
  ctx.fillStyle = "#0b1220";
  ctx.fillRect(0,0,out.width,out.height);

  // title
  ctx.fillStyle = "rgba(234,240,255,.95)";
  ctx.font = "900 28px ui-sans-serif, system-ui";
  ctx.fillText("Ecossistema Docente ‚Äî Diagn√≥stico", 24, 46);

  ctx.fillStyle = "rgba(234,240,255,.70)";
  ctx.font = "700 14px ui-sans-serif, system-ui";
  const name = (val("name")||"Visitante").trim();
  const uni = (val("uni")||"‚Äî").trim();
  ctx.fillText(`${name} ¬∑ ${uni} ¬∑ ${new Date().toLocaleDateString()}`, 24, 70);

  // draw radar
  ctx.drawImage(radar, 24, 90, 1050, 360);
  // draw map
  ctx.drawImage(mapa, 24, 470, 1050, 320);

  const link = document.createElement("a");
  link.download = "ecossistema-docente-diagnostico.png";
  link.href = out.toDataURL("image/png");
  link.click();
});

// ------------------ DEV: RANDOM FILL ------------------
document.getElementById("btnRandom").addEventListener("click", ()=>{
  QUESTIONS.forEach((q,i)=>{
    const pick = Math.floor(Math.random()*q.o.length);
    const el = document.getElementById(`q${i}_${pick}`);
    if(el) el.checked = true;
  });
  updateProgress();
});

// init
buildQuiz();
updateProgress();

// start with blank drawing
drawRadar({R:0,E:0,T:0,G:0,I:0,B:0},{R:0,E:0,T:0,G:0,I:0,B:0},0);
drawMap({R:0,E:0,T:0,G:0,I:0,B:0},{R:0,E:0,T:0,G:0,I:0,B:0},0,0);
</script>
</body>
</html>
